(function(g,f){typeof exports=="object"&&typeof module<"u"?module.exports=f():typeof define=="function"&&define.amd?define(f):(g=typeof globalThis<"u"?globalThis:g||self,g.StudioSdkPlugins_listPagesComponent=f())})(this,function(){"use strict";const g="app.grapesjs.com",f="app-stage.grapesjs.com",M=[g,"app2.grapesjs.com",f,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],D="license:check:start",$="license:check:end",S=()=>typeof window<"u",O=({isDev:e,isStage:s})=>`${e?"":`https://${s?f:g}`}/api`,x=()=>{const e=S()&&window.location.hostname;return!!e&&(M.includes(e)||M.some(s=>e.endsWith(s)))};async function R({path:e,baseApiUrl:s,method:i="GET",headers:t={},params:o,body:a}){const c=`${s||O({isDev:!1,isStage:!1})}${e}`,r={method:i,headers:{"Content-Type":"application/json",...t}};a&&(r.body=JSON.stringify(a));const u=o?new URLSearchParams(o).toString():"",n=u?`?${u}`:"",l=await fetch(`${c}${n}`,r);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return l.json()}var h=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(h||{});const V={[h.free]:0,[h.startup]:10,[h.business]:20,[h.enterprise]:30};function U(e){const s=e;return s.init=i=>t=>e(t,i),s}const W=e=>U(e);async function j({editor:e,plan:s,pluginName:i,licenseKey:t,cleanup:o}){let a="",p=!1;const c=x(),r=n=>{console.warn("Cleanup plugin:",i,"Reason:",n),o()},u=(n={})=>{var L;const{error:l,sdkLicense:E}=n,P=(L=n.plan)==null?void 0:L.category;if(!(E||n.license)||l)r(l||"Invalid license");else if(P){const w=V[s],A=V[P];w>A&&r({pluginRequiredPlan:s,licensePlan:P})}};e.on(D,n=>{a=n==null?void 0:n.baseApiUrl,p=!0}),e.on($,n=>{u(n)}),setTimeout(async()=>{if(!p){if(c)return;if(t){const n=await B({licenseKey:t,pluginName:i,baseApiUrl:a});n&&u(n)}else r("The `licenseKey` option not provided")}},2e3)}async function B(e){const{licenseKey:s,pluginName:i,baseApiUrl:t}=e;try{return(await R({baseApiUrl:t,path:`/sdk/${s||"na"}`,method:"POST",params:{d:window.location.hostname,pn:i}})).result||{}}catch(o){return console.error("Error during SDK license check:",o),!1}}const _="gjs-plg-",G="listPagesComponent",K=h.startup;function F(e,s,i){let t,o,a,p,c;const r=s;function u(){const l=Date.now()-p;l<r&&l>=0?t=setTimeout(u,r-l):(t=null,c=e.apply(a,o),a=o=null)}const n=function(){return a=this,o=arguments,p=Date.now(),t||(t=setTimeout(u,r)),c};return n.clear=function(){t&&(clearTimeout(t),t=null)},n.flush=function(){t&&(c=e.apply(a,o),a=o=null,clearTimeout(t),t=null)},n}const k="page://",m="list-pages",y="list-pages-item",d="list-pages-link",q=e=>e.components().reduce((s,i)=>{var p;const t=i.findFirstType(d),o=(p=t==null?void 0:t.attributes.attributes)==null?void 0:p.href,a=o!=null&&o.startsWith(k)?o.replace(k,""):"";if(a&&t){const c=s[a];c?c.push(t):s[a]=[t]}return s},{}),b="data-type-role",X="page_root",Y=e=>s=>s.is(e),Z=e=>(s,i)=>i.is(e),H=e=>s=>{var i;return((i=s.getAttribute)==null?void 0:i.call(s,b))===e};return W(function(e,s={}){const{Blocks:i,Components:t,Pages:o}=e,{licenseKey:a,block:p={}}=s,c="List Pages",r="List Pages Item",u="Link",n=`${_}${m}`,l=`${_}${d}`,E='<svg viewBox="0 0 24 24"><path d="M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"/></svg>',P='<svg viewBox="0 0 24 24"><path d="M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z" /></svg>';t.addType(m,{block:p&&{label:c,media:E,category:"Extra",select:!0,...s.block},isComponent:H(m),model:{defaults:{tagName:"ul",name:c,[X]:"",classes:n,attributes:{[b]:m,role:"navigation"},droppable:Y(y),styles:`
          .${n} {
            list-style: none;
            margin: 0;
            padding: 0;
          }
        `},init(){this.syncPageItems=F(this.syncPageItems.bind(this),0),this.listenTo(this.em,o.events.all,this.syncPageItems),this.syncPageItems()},syncPageItems(){if(e.Components.getSymbolInfo(this).isInstance)return;const T=this.em.Pages.getAll(),L=this.components(),w=q(this);T.forEach((A,J)=>{const v=A.id,C=A.getName(),I=w[v];I?I==null||I.forEach(N=>{N.getInnerHTML()!==C&&N.components(C)}):L.add({type:y,components:[{type:d,attributes:{href:`page://${v}`},components:{type:"textnode",content:C}}]},{at:J})})}}}),t.addType(y,{isComponent:H(y),model:{defaults:{name:r,tagName:"li",icon:P,attributes:{[b]:y},components:{type:d},draggable:Z(m)}}}),t.addType(d,{extend:"link",isComponent:H(d),model:{defaults:{removable:!1,copyable:!1,delegate:{move:T=>T.closestType(y)},name:u,classes:l,attributes:{[b]:d},components:{type:"textnode",content:"Item"},styles:`
          .${l} {
            text-decoration: none;
          }
        `}}}),j({editor:e,licenseKey:a,plan:K,pluginName:G,cleanup:()=>{i.remove(m),t.removeType(m)}})})});
