"use strict";var P=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(P||{}),B=(e=>(e.toastAdd="studio:toastAdd",e.toastRemove="studio:toastRemove",e.dialogOpen="studio:dialogOpen",e.dialogClose="studio:dialogClose",e.dialogExportCode="studio:dialogExportCode",e.sidebarLeftSet="studio:sidebarLeft:set",e.sidebarLeftGet="studio:sidebarLeft:get",e.sidebarLeftToggle="studio:sidebarLeft:toggle",e.sidebarRightSet="studio:sidebarRight:set",e.sidebarRightGet="studio:sidebarRight:get",e.sidebarRightToggle="studio:sidebarRight:toggle",e.sidebarTopSet="studio:sidebarTop:set",e.sidebarTopGet="studio:sidebarTop:get",e.sidebarTopToggle="studio:sidebarTop:toggle",e.sidebarBottomSet="studio:sidebarBottom:set",e.sidebarBottomGet="studio:sidebarBottom:get",e.sidebarBottomToggle="studio:sidebarBottom:toggle",e.symbolAdd="studio:symbolAdd",e.symbolDetach="studio:symbolDetach",e.symbolOverride="studio:symbolOverride",e.symbolPropagateStyles="studio:propagateStyles",e.getPagesConfig="studio:getPagesConfig",e.setPagesConfig="studio:setPagesConfig",e.getPageSettings="studio:getPageSettings",e.setPageSettings="studio:setPageSettings",e.clearPage="studio:clearPage",e.projectFiles="studio:projectFiles",e.validateCode="studio:validateCode",e.canvasReload="studio:canvasReload",e.getBlocksPanel="studio:getBlocksPanel",e.setBlocksPanel="studio:setBlocksPanel",e.getStateContextMenu="studio:getStateContextMenu",e.setStateContextMenu="studio:setStateContextMenu",e.contextMenuComponent="studio:contextMenuComponent",e.layoutAdd="studio:layoutAdd",e.layoutRemove="studio:layoutRemove",e.layoutToggle="studio:layoutToggle",e.layoutUpdate="studio:layoutUpdate",e.layoutGet="studio:layoutGet",e.layoutConfigGet="studio:layoutConfigGet",e.layoutConfigSet="studio:layoutConfigSet",e.getStateTheme="studio:getStateTheme",e.setStateTheme="studio:setStateTheme",e.assetProviderGet="studio:assetProviderGet",e.assetProviderAdd="studio:assetProviderAdd",e.assetProviderRemove="studio:assetProviderRemove",e.fontGet="studio:fontGet",e.fontAdd="studio:fontAdd",e.fontRemove="studio:fontRemove",e.fontManagerOpen="studio:fontManagerOpen",e.menuFontLoad="studio:menuFontLoad",e.toggleStateDataSource="studio:toggleStateDataSource",e.getStateDataSource="studio:getStateDataSource",e.dataSourceSetGlobalData="studio:dataSourceSetGlobalData",e.dataSourceSetImporter="studio:dataSourceSetImporter",e.dataSourceSetExporter="studio:dataSourceSetExporter",e.setDragAbsolute="studio:setDragAbsolute",e))(B||{}),I=(e=>(e.layoutToggleId="studio:layoutToggle:",e.toggleBlocksPanel="studio:toggleBlocksPanel",e.pageSettingsUpdate="studio:pageSettingsUpdate",e.toggleDataSourcesPreview="studio:toggleDataSourcesPreview",e))(I||{});const x="app.grapesjs.com",E="app-stage.grapesjs.com",$="app2.grapesjs.com",H="app-stage2.grapesjs.com",D=[x,$,E,H,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],j="license:check:start",W="license:check:end",C=()=>typeof window<"u",K=({isDev:e,isStage:a})=>`${e?"":`https://${a?E:x}`}/api`,V=()=>{const e=C()&&window.location.hostname;return!!e&&(D.includes(e)||D.some(a=>e.endsWith(a)))};async function F({path:e,baseApiUrl:a,method:n="GET",headers:i={},params:c,body:p}){const b=`${a||K({isDev:!1,isStage:!1})}${e}`,g={method:n,headers:{"Content-Type":"application/json",...i}};p&&(g.body=JSON.stringify(p));const d=c?new URLSearchParams(c).toString():"",t=d?`?${d}`:"",r=await fetch(`${b}${t}`,g);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}const M={[P.free]:0,[P.startup]:10,[P.business]:20,[P.enterprise]:30};function m(e){const a=e;return a.init=n=>i=>e(i,n),a}const q=e=>m(e);async function Z({editor:e,plan:a,pluginName:n,licenseKey:i,cleanup:c}){let p="",f=!1;const b=V(),g=t=>{console.warn("Cleanup plugin:",n,"Reason:",t),c()},d=(t={})=>{var o;const{error:r,sdkLicense:L}=t,s=(o=t.plan)==null?void 0:o.category;if(!(L||t.license)||r)g(r||"Invalid license");else if(s){const l=M[a],y=M[s];l>y&&g({pluginRequiredPlan:a,licensePlan:s})}};e.on(j,t=>{p=t==null?void 0:t.baseApiUrl,f=!0}),e.on(W,t=>{d(t)}),setTimeout(async()=>{if(!f){if(b)return;if(i){const t=await z({licenseKey:i,pluginName:n,baseApiUrl:p});t&&d(t)}else g("The `licenseKey` option not provided")}},2e3)}async function z(e){const{licenseKey:a,pluginName:n,baseApiUrl:i}=e;try{return(await F({baseApiUrl:i,path:`/sdk/${a||"na"}`,method:"POST",params:{d:window.location.hostname,pn:n}})).result||{}}catch(c){return console.error("Error during SDK license check:",c),!1}}var v=(e=>(e.panelBlocks="panelBlocks",e.panelPagesLayers="panelPagesLayers",e.panelGlobalStyles="panelGlobalStyles",e.panelSidebarTabs="panelSidebarTabs",e.panelAssets="panelAssets",e.aiChatPanel="aiChatPanel",e.panelDataSources="panelDataSources",e))(v||{});const O="sidebarButtonsTarget",w=(e,a)=>{const{id:n,icon:i,label:c,tooltip:p,className:f,skipSelfClose:b,removeLayouts:g,layoutComponent:d,layoutCommand:t}=e,{pluginOpts:r,breakpointProps:L}=a,s=n;return{id:S(n),type:"button",icon:i,tooltip:c||p,className:f,editorEvents:{[`${I.layoutToggleId}${s}`]:({fromEvent:u,setState:o,editor:l})=>{o({active:u.isOpen}),setTimeout(()=>l.refresh({tools:!0}),20)}},onClick:({editor:u,state:o})=>{var k;if(o.active&&b)return;const l=(t==null?void 0:t.placer)||{type:"static",layoutId:O},y={...l,skipCleanup:l.type==="static"},h=g||Object.keys(v).filter(R=>R!==s);U(u,{removeLayouts:h,layout:{placer:y}});const A={id:s,placer:l,header:(t==null?void 0:t.header)??{label:c,close:!b},layout:d,style:{width:280,height:"100%",borderRightWidth:1,...t==null?void 0:t.style}},T=((k=r==null?void 0:r.sidebarLayoutCommand)==null?void 0:k.call(r,{...L,layoutCommand:A,sidebarButtonProps:e}))||A;u.runCommand(B.layoutToggle,{...T})}}},S=e=>`button__${e}`,U=(e,a={})=>{(a.removeLayouts||Object.keys(v)).forEach(i=>e.runCommand(B.layoutRemove,{id:i,layout:a.layout}))},N=e=>{const a=(e==null?void 0:e.breakpointTablet)??1024,n=(e==null?void 0:e.breakpointMobile)??768,i={},c=[{id:v.panelBlocks,icon:"plusBox",label:"Blocks",layoutComponent:{type:"panelBlocks"}},{id:v.panelPagesLayers,icon:"layers",label:"Pages & Layers",layoutComponent:{type:"panelPagesLayers"}},{id:v.panelGlobalStyles,icon:'<svg viewBox="0 0 24 24"> <path d="M20 14H6c-2.2 0-4 1.8-4 4s1.8 4 4 4h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2M6 20c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m.3-8L13 5.3a2 2 0 0 1 2.8 0l2.8 2.8c.8.8.8 2 0 2.8l-.9 1.1H6.3M2 13.5V4c0-1.1.9-2 2-2h4a2 2 0 0 1 2 2v1.5l-8 8Z"/></svg>',label:"Global Styles",layoutComponent:{type:"panelGlobalStyles"}},{id:v.panelAssets,icon:'<svg viewBox="0 0 24 24"><path d="M22,16V4A2,2 0 0,0 20,2H8A2,2 0 0,0 6,4V16A2,2 0 0,0 8,18H20A2,2 0 0,0 22,16M11,12L13.03,14.71L16,11L20,16H8M2,6V20A2,2 0 0,0 4,22H18V20H4V6" /></svg>',label:"Assets",layoutComponent:{type:"panelAssets",content:{itemsPerRow:2,header:{addUrl:!1}},style:{padding:7},onSelect:({assetProps:s,editor:u})=>{var h;const o=u.getSelected(),l={type:"image",src:s.src};let y;if(o!=null&&o.is("image"))return o.set("src",s.src);o&&u.Components.canMove(o,l)?y=o.append(l)[0]:o||(y=(h=u.getWrapper())==null?void 0:h.append(l)[0]),y&&u.select(y,{scroll:!0})}}}],p=[...c,{id:v.panelSidebarTabs,layoutCommand:{header:!1},icon:'<svg viewBox="0 0 24 24"><path d="M17.5 12a1.5 1.5 0 0 1-1.5-1.5A1.5 1.5 0 0 1 17.5 9a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5m-3-4A1.5 1.5 0 0 1 13 6.5 1.5 1.5 0 0 1 14.5 5 1.5 1.5 0 0 1 16 6.5 1.5 1.5 0 0 1 14.5 8m-5 0A1.5 1.5 0 0 1 8 6.5 1.5 1.5 0 0 1 9.5 5 1.5 1.5 0 0 1 11 6.5 1.5 1.5 0 0 1 9.5 8m-3 4A1.5 1.5 0 0 1 5 10.5 1.5 1.5 0 0 1 6.5 9 1.5 1.5 0 0 1 8 10.5 1.5 1.5 0 0 1 6.5 12M12 3a9 9 0 0 0-9 9 9 9 0 0 0 9 9 1.5 1.5 0 0 0 1.5-1.5c0-.4-.2-.7-.4-1-.2-.3-.4-.6-.4-1a1.5 1.5 0 0 1 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8Z"/></svg>',label:"Styles & Props",layoutComponent:{type:"panelSidebarTabs"}}],f={id:O,type:"column",className:"gs-cmp-layout-sidebar-target",style:{overflow:"hidden"}},b={type:"sidebarLeft",resizable:!1,style:{padding:"10px 5px",alignItems:"center",width:45,gap:10},children:[]},g={type:"canvasSidebarTop",sidebarTop:{leftContainer:{buttons:[]}}},d=s=>({breakpoint:s,breakpointTablet:a,breakpointMobile:n}),t=(s,u,o)=>{const l=d(u),y={pluginOpts:e,breakpointProps:l},h=s.map(T=>{const k=w(T,y);return e!=null&&e.sidebarButton?e.sidebarButton({id:T.id,buttonIds:v,buttonProps:k,sidebarButtonProps:T,...l,createSidebarButton:R=>w({...T,...R},y)}):k}).filter(Boolean);return(e!=null&&e.sidebarButtons?e==null?void 0:e.sidebarButtons({buttonIds:v,sidebarButtons:h,...l,createSidebarButton:T=>w({...T,layoutCommand:{...o==null?void 0:o.layoutCommand,...T.layoutCommand}},y)}):h).filter(Boolean)},r=(s,u,o)=>{var h;const l=d(o),y={pluginOpts:e,breakpointProps:l};return((h=e==null?void 0:e.rootLayout)==null?void 0:h.call(e,{sidebarButtons:u,rootLayout:s,layoutSidebarLeft:b,layoutSidebarTarget:f,...l,createSidebarButton:A=>w({...A},y)}))??s};if(a){const s=t(p,a);i[a]=r({type:"row",style:{height:"100%"},children:[{...b,children:s},f,g]},s,a)}if(n){const s={placer:{type:"absolute",position:"left"},style:{height:"calc(100% - 40px)"}},u=p.map(l=>({...l,layoutCommand:s})),o=t(u,n,{layoutCommand:s});i[n]=r({type:"column",style:{height:"100%"},children:[{type:"sidebarTop",leftContainer:{buttons:[]}},{type:"canvas",grow:!0},{type:"sidebarBottom",style:{padding:"0 5px",alignItems:"center",gap:10,minHeight:39},children:o}]},o,n)}const L=t(c,0);return{default:r({type:"row",style:{height:"100%"},children:[{...b,children:L},f,g,{type:"sidebarRight"}]},L,0),responsive:i}},G="layoutSidebarButtons",J=P.free,Q=function(e,a={}){const{Commands:n}=e,i=n.events,c={...a};(()=>{if(e.runCommand(B.layoutConfigGet)||c.skipLayoutConfig===!0)return;const b=N(c);e.runCommand(B.layoutConfigSet,{...b})})(),n.add(`${G}:toggleButton`,(f,b,g)=>{const d=document.getElementById(S(g==null?void 0:g.id));d==null||d.click()}),e.on(`${i.runCommand}core:preview`,()=>{U(e)}),Z({editor:e,licenseKey:c.licenseKey,plan:J,pluginName:G,cleanup:()=>{e.runCommand(B.layoutConfigSet)}})},_=q(Q);_.createLayoutConfig=e=>N(e);module.exports=_;
