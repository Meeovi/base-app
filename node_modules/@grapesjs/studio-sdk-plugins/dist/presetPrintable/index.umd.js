(function(B,k){typeof exports=="object"&&typeof module<"u"?module.exports=k():typeof define=="function"&&define.amd?define(k):(B=typeof globalThis<"u"?globalThis:B||self,B.StudioSdkPlugins_presetPrintable=k())})(this,function(){"use strict";const B="app.grapesjs.com",k="app-stage.grapesjs.com",U=[B,"app2.grapesjs.com",k,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],Y="license:check:start",J="license:check:end",X=()=>typeof window<"u",I=(e,n={})=>{const t=ee(e)?{id:e,src:e}:e;return new Promise((s,a)=>{var g,h;const{loadedScripts:o}=n,{id:i,src:p}=t,c=document.querySelector(`script[src="${p}"]`);if(c){if((g=n.onScript)==null||g.call(n,c),o&&!o.get(p)){c.addEventListener("load",()=>s(i)),c.addEventListener("error",()=>a(i));return}return s(i)}const u=window.define;window.define=void 0;const l=()=>{o==null||o.set(p,!0),window.define=u},r=document.createElement("script");r.src=p,r.onload=()=>{s(i),l()},r.onerror=()=>{a(i),l()},document.head.appendChild(r),(h=n.onScript)==null||h.call(n,r)})},Z=({isDev:e,isStage:n})=>`${e?"":`https://${n?k:B}`}/api`,Q=()=>{const e=X()&&window.location.hostname;return!!e&&(U.includes(e)||U.some(n=>e.endsWith(n)))},ee=e=>typeof e=="string";async function te({path:e,baseApiUrl:n,method:t="GET",headers:s={},params:a,body:o}){const p=`${n||Z({isDev:!1,isStage:!1})}${e}`,c={method:t,headers:{"Content-Type":"application/json",...s}};o&&(c.body=JSON.stringify(o));const u=a?new URLSearchParams(a).toString():"",l=u?`?${u}`:"",r=await fetch(`${p}${l}`,c);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}var R=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(R||{}),N=(e=>(e.toastAdd="studio:toastAdd",e.toastRemove="studio:toastRemove",e.dialogOpen="studio:dialogOpen",e.dialogClose="studio:dialogClose",e.dialogExportCode="studio:dialogExportCode",e.sidebarLeftSet="studio:sidebarLeft:set",e.sidebarLeftGet="studio:sidebarLeft:get",e.sidebarLeftToggle="studio:sidebarLeft:toggle",e.sidebarRightSet="studio:sidebarRight:set",e.sidebarRightGet="studio:sidebarRight:get",e.sidebarRightToggle="studio:sidebarRight:toggle",e.sidebarTopSet="studio:sidebarTop:set",e.sidebarTopGet="studio:sidebarTop:get",e.sidebarTopToggle="studio:sidebarTop:toggle",e.sidebarBottomSet="studio:sidebarBottom:set",e.sidebarBottomGet="studio:sidebarBottom:get",e.sidebarBottomToggle="studio:sidebarBottom:toggle",e.symbolAdd="studio:symbolAdd",e.symbolDetach="studio:symbolDetach",e.symbolOverride="studio:symbolOverride",e.symbolPropagateStyles="studio:propagateStyles",e.getPagesConfig="studio:getPagesConfig",e.setPagesConfig="studio:setPagesConfig",e.getPageSettings="studio:getPageSettings",e.setPageSettings="studio:setPageSettings",e.clearPage="studio:clearPage",e.projectFiles="studio:projectFiles",e.validateCode="studio:validateCode",e.canvasReload="studio:canvasReload",e.getBlocksPanel="studio:getBlocksPanel",e.setBlocksPanel="studio:setBlocksPanel",e.getStateContextMenu="studio:getStateContextMenu",e.setStateContextMenu="studio:setStateContextMenu",e.contextMenuComponent="studio:contextMenuComponent",e.layoutAdd="studio:layoutAdd",e.layoutRemove="studio:layoutRemove",e.layoutToggle="studio:layoutToggle",e.layoutUpdate="studio:layoutUpdate",e.layoutGet="studio:layoutGet",e.layoutConfigGet="studio:layoutConfigGet",e.layoutConfigSet="studio:layoutConfigSet",e.getStateTheme="studio:getStateTheme",e.setStateTheme="studio:setStateTheme",e.assetProviderGet="studio:assetProviderGet",e.assetProviderAdd="studio:assetProviderAdd",e.assetProviderRemove="studio:assetProviderRemove",e.fontGet="studio:fontGet",e.fontAdd="studio:fontAdd",e.fontRemove="studio:fontRemove",e.fontManagerOpen="studio:fontManagerOpen",e.menuFontLoad="studio:menuFontLoad",e.toggleStateDataSource="studio:toggleStateDataSource",e.getStateDataSource="studio:getStateDataSource",e.dataSourceSetGlobalData="studio:dataSourceSetGlobalData",e.dataSourceSetImporter="studio:dataSourceSetImporter",e.dataSourceSetExporter="studio:dataSourceSetExporter",e.setDragAbsolute="studio:setDragAbsolute",e))(N||{});const F={[R.free]:0,[R.startup]:10,[R.business]:20,[R.enterprise]:30};function se(e){const n=e;return n.init=t=>s=>e(s,t),n}const ne=e=>se(e);async function oe({editor:e,plan:n,pluginName:t,licenseKey:s,cleanup:a}){let o="",i=!1;const p=Q(),c=l=>{console.warn("Cleanup plugin:",t,"Reason:",l),a()},u=(l={})=>{var w;const{error:r,sdkLicense:g}=l,h=(w=l.plan)==null?void 0:w.category;if(!(g||l.license)||r)c(r||"Invalid license");else if(h){const d=F[n],f=F[h];d>f&&c({pluginRequiredPlan:n,licensePlan:h})}};e.on(Y,l=>{o=l==null?void 0:l.baseApiUrl,i=!0}),e.on(J,l=>{u(l)}),setTimeout(async()=>{if(!i){if(p)return;if(s){const l=await ae({licenseKey:s,pluginName:t,baseApiUrl:o});l&&u(l)}else c("The `licenseKey` option not provided")}},2e3)}async function ae(e){const{licenseKey:n,pluginName:t,baseApiUrl:s}=e;try{return(await te({baseApiUrl:s,path:`/sdk/${n||"na"}`,method:"POST",params:{d:window.location.hostname,pn:t}})).result||{}}catch(a){return console.error("Error during SDK license check:",a),!1}}const ie=e=>n=>{var t;return((t=n.getAttribute)==null?void 0:t.call(n,z))===e},re=(...e)=>(n,t)=>e.some(s=>t.is(s)),W=(e,n,t)=>{const{doc:s=document}=t,a=t.target||s.head,o=a.querySelector(`style[${e}]`)||s.createElement("style");o.setAttribute(e,"true"),o.innerHTML=n,!a.contains(o)&&a.appendChild(o)},ce="gjs-plg-",C="data-gs-plg-",z="data-type-role";function K(e,n,t){let s,a,o,i,p;const c=n===void 0?100:n;function u(){const r=Date.now()-i;r<c&&r>=0?s=setTimeout(u,c-r):(s=null,p=e.apply(o,a),o=a=null)}const l=function(){return o=this,a=arguments,i=Date.now(),s||(s=setTimeout(u,c)),p};return l.clear=function(){s&&(clearTimeout(s),s=null)},l.flush=function(){s&&(p=e.apply(o,a),o=a=null,clearTimeout(s),s=null)},l}const E="page-break";var m=(e=>(e.A5="a5",e.A5Portrait="a5-portrait",e.A4="a4",e.A3="a3",e.B5="b5",e.B4="b4",e.letter="letter",e.legal="legal",e.ledger="ledger",e))(m||{});function _(e,n){const s={mm:3.7795275590551185,cm:37.79527559055118,in:96,pt:1.3333333333333333,pc:16};return s[n]?e*s[n]:null}const le=(e,n)=>{const{name:t,id:s,width:a,height:o,unit:i}=e,{fixedHeight:p}=n,c=`${a}${i}`,u=`${o}${i}`;return{id:s||t.toLowerCase().replace(/\s/g,"-"),name:`${t} (${c} x ${u})`,sizeH:o,sizeW:a,sizeUnit:i,widthMedia:"",width:c,minHeight:p?"0":`${_(o,i)}px`,height:p?u:void 0}},j="page-breaks",D="gjs-page-breaks-spot",M=e=>e.type===j;function de(e){const{Devices:n}=e,{height:t,minHeight:s}=n.getSelected().attributes,o=parseFloat(`${t&&t!=="auto"?t:s}`),i=e.getWrapper(),p=i==null?void 0:i.getEl(),c=[];if(!i||!p)return c;const u=p.getBoundingClientRect().height,r=i.findType(E).map(h=>h.getEl()).filter(Boolean).map(h=>({top:h.offsetTop,height:h.offsetHeight}));let g=0;for(;g<u;){const h=r.find(y=>y.top>g&&y.top<g+o);h?(g=h.top+h.height,c.push(h.top)):(g+=o,g<u&&c.push(g))}return c}function pe(e,n){const{Canvas:t}=e,s=t.events,a=e.events;let o;const i=()=>{W(`${C}preset-printable-spots`,`.${D} {
        position: absolute;
        left: 0;
        width: 100%;
        border-top: 1px dashed var(--gs-theme-cl-cmp-bg2, var(--gjs-color-blue));
        color: var(--gs-theme-cl-prm-txt, var(--gjs-font-color));
      }
      .${D}::after {
        background-color: var(--gs-theme-cl-cmp-bg1, var(--gjs-color-highlight));
        content: attr(data-page-number);
        display: block;
        padding: 0 0.5rem;
        border-radius: 2px;
        position: absolute;
        top: -2px;
        right: 0;
        transform: translate(100%, -50%);
      }
      `,{target:window.document.head})},p=()=>{if(n.enablePageBreaksSpot===!1)return;const d={id:j,type:j,component:e.getWrapper()};return t.getSpots(d).pop()||t.addSpot(d)},c=({spot:d})=>{const{spotEl:f}=d.attributes;!M(d)||!f||!o||o.removeChild(f)},u=({spot:d})=>{if(!M(d)||!o)return;let{spotEl:f}=d.attributes;f||(f=document.createElement("div"),f.className=`${D}__items`,d.set({spotEl:f})),o.appendChild(f)},l=({spot:d})=>{const{spotEl:f,pageBreaks:G=[]}=d.attributes;!M(d)||!f||!o||(Object.entries(d.getStyle()).forEach(([$,x])=>f.style.setProperty($,x)),f.innerHTML="",G.forEach(($,x)=>{const A=document.createElement("div");A.setAttribute("data-page-number",`${x+2}`),A.className=D,A.style.top=`${$}px`,f.appendChild(A)}))},r=K(()=>{if(e.em.destroyed)return;const d=p();d&&d.set({pageBreaks:de(e),up:(d.attributes.up||0)+1})},150),g=K(r,200),h=()=>{o=t.getSpotsEl(),p()},y=()=>{const d=p();d&&d.set({up:(d.attributes.up||0)+1})},w=[["component:input",r],["frame:scroll",y],[a.update,r],[s.spotAdd,u],[s.spotUpdate,l],[s.spotRemove,c],[s.frameLoadBody,h]];return w.forEach(([d,f])=>e.on(d,f)),e.onReady(()=>{i(),new ResizeObserver(y).observe(t.getElement().parentElement)}),()=>{w.forEach(([d,f])=>e.off(d,f)),r.clear(),g.clear()}}var H=(e=>(e.print="presetPrintable:print",e))(H||{});const q=e=>new Promise(n=>{const t=document.createElement("iframe");t.style.cssText="position: absolute; width: 0; height: 0; border: 0; opacity: 0; pointer-events: none;",t.srcdoc=e.content,t.onload=()=>n(t),document.body.appendChild(t)});function ge(e,n){const{Commands:t,Pages:s}=e;return t.add(H.print,async(a,o,i={})=>{const p={page:i.allPages?void 0:s.getSelected(),styles:"inline",optionsHtml:{exporter:null}},u=(await t.run(N.projectFiles,p)).filter(g=>g.filename.endsWith(".html")),l=u.map(g=>g.content).join('<div style="break-before: page;"></div>'),r=[];if(i.separatePrints)for(const g of u)r.push(await q(g));else r.push(await q({content:l,filename:"",mimeType:""}));for(const g of r){const h=g.contentWindow;h.focus(),h.print()}setTimeout(()=>r.forEach(g=>g.remove()),1e3)}),t.add("presetPrintable:exp",async a=>{await I("https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"),await I("https://cdn.jsdelivr.net/npm/jspdf@3.0.0/dist/jspdf.umd.min.js");const{Devices:o,Canvas:i}=a,{sizeW:p,sizeH:c,sizeUnit:u}=o.getSelected().attributes,l=i.getFrameEl().contentDocument,r="px",g=[_(p,u),_(c,u)],h=new window.jspdf.jsPDF({unit:r,format:g}),y=l.body;h.html(y,{callback:w=>w.save()})}),()=>{delete e.Commands.commands[H.print]}}function ue(e,n){const{blockPageBreak:t={}}=n,{Components:s,Blocks:a}=e,o="Page Break",i=`${ce}${E}`;return s.addType(E,{block:t&&{label:o,media:'<svg viewBox="0 0 24 24"><path d="M18 20H6v-2H4v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2h-2v2M14 2H6a2 2 0 0 0-2 2v8h2V4h8v4h4v4h2V8l-6-6m-3 14H8v-2h3v2m5 0h-3v-2h3v2M3 14h3v2H3v-2m18 2h-3v-2h3v2Z"/></svg>',category:"Extra",select:!0,...t},isComponent:ie(E),model:{defaults:{name:o,classes:i,attributes:{[z]:E},emptyState:!0,stylable:!1,droppable:!1,draggable:re("wrapper"),styles:`.${i} { break-before: page; }`,traits:[]}}}),()=>{s.removeType(E),a.remove(E)}}const he="presetPrintable",fe=R.free;return ne(function(e,n={}){var V;const t={selectedDevice:m.A4,...n},{Canvas:s,Devices:a,Blocks:o}=e,i=s.events,p=e.events,c=t.selectedDevice||a.getConfig().default,u=[{id:m.A5,name:"A5",width:148,height:210,unit:"mm"},{id:m.A5Portrait,name:"A5 Portrait",width:210,height:148,unit:"mm"},{id:m.A4,name:"A4",width:210,height:297,unit:"mm"},{id:m.A3,name:"A3",width:297,height:420,unit:"mm"},{id:m.B5,name:"B5",width:176,height:250,unit:"mm"},{id:m.B4,name:"B4",width:250,height:353,unit:"mm"},{id:m.letter,name:"Letter",width:8.5,height:11,unit:"in"},{id:m.legal,name:"Legal",width:8.5,height:14,unit:"in"},{id:m.ledger,name:"Ledger",width:11,height:17,unit:"in"}],r=(((V=t.devices)==null?void 0:V.call(t,{items:u}))||u).map(v=>le(v,t));a.devices.reset(r);const g=c&&a.get(c)||a.getAll().at(0);a.select(g),["map","video"].forEach(v=>o.remove(v));const y=(v={})=>{const b="page-rule",{rules:P}=e.Css,{width:T,height:L,minHeight:S}=a.getSelected().attributes,ve=L&&L!=="auto"?L:S,O=P.where({id:b}).pop(),be=O||P.add({id:b,selectors:[],selectorsAdd:"@page"},{at:0});(v.fromDeviceChange||!O)&&be.addStyle({size:`${T} ${ve}`,...!O&&{margin:"0"}})},w=(v,b={})=>{const P=v.document,{minHeight:T}=a.getSelected().attributes,S=`
      ${!!parseFloat(`${T}`)?`
        [data-gjs-type="wrapper"] { min-height: ${T}; }
      `:`
        body {
          overflow: hidden;
        }

        [data-gjs-type="wrapper"] {
            overflow: hidden;
            height: 100dvh;
        }
      `}
    `;W(`${C}preset-printable`,S,{doc:P,target:P.head}),y(b)};e.on(i.frameLoadBody,v=>{const b=v.window;if(w(b),t.fixedHeight){const T=v.model.getComponent().getEl();T==null||T.addEventListener("scroll",L=>{const S=L.target;S.scrollTop>0&&S.scrollTo(0,0)})}}),e.on(a.events.select,()=>{var b;const v=(b=s.getFrameEl().contentDocument)==null?void 0:b.defaultView;v&&w(v,{fromDeviceChange:!0})});const d=()=>{const b=e.Css.getRules().filter(P=>P.selectorsToString()==="body").pop();b==null||b.addStyle({"margin-top":"","margin-right":"","margin-bottom":"","margin-left":"",margin:"0"})},f=[[p.projectLoad,d]];f.forEach(([v,b])=>e.on(v,b));const G=pe(e,t),$=ge(e),x=ue(e,t);e.onReady(()=>{e.UndoManager.clear()});const A=()=>{f.forEach(([v,b])=>e.off(v,b)),G(),$(),x()};e.on(p.destroy,A),oe({editor:e,licenseKey:t.licenseKey,plan:fe,pluginName:he,cleanup:A})})});
