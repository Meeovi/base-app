(function(h,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(h=typeof globalThis<"u"?globalThis:h||self,h.StudioSdkPlugins_linkImageComponent=g())})(this,function(){"use strict";const h="app.grapesjs.com",g="app-stage.grapesjs.com",k=[h,"app2.grapesjs.com",g,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],I="license:check:start",v="license:check:end",C=()=>typeof window<"u",D=({isDev:e,isStage:s})=>`${e?"":`https://${s?g:h}`}/api`,N=()=>{const e=C()&&window.location.hostname;return!!e&&(k.includes(e)||k.some(s=>e.endsWith(s)))};async function L({path:e,baseApiUrl:s,method:i="GET",headers:o={},params:a,body:c}){const b=`${s||D({isDev:!1,isStage:!1})}${e}`,r={method:i,headers:{"Content-Type":"application/json",...o}};c&&(r.body=JSON.stringify(c));const m=a?new URLSearchParams(a).toString():"",t=m?`?${m}`:"",l=await fetch(`${b}${t}`,r);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return l.json()}var f=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(f||{});const A={[f.free]:0,[f.startup]:10,[f.business]:20,[f.enterprise]:30};function E(e){const s=e;return s.init=i=>o=>e(o,i),s}const _=e=>E(e);async function P({editor:e,plan:s,pluginName:i,licenseKey:o,cleanup:a}){let c="",p=!1;const b=N(),r=t=>{console.warn("Cleanup plugin:",i,"Reason:",t),a()},m=(t={})=>{var u;const{error:l,sdkLicense:y}=t,n=(u=t.plan)==null?void 0:u.category;if(!(y||t.license)||l)r(l||"Invalid license");else if(n){const T=A[s],w=A[n];T>w&&r({pluginRequiredPlan:s,licensePlan:n})}};e.on(I,t=>{c=t==null?void 0:t.baseApiUrl,p=!0}),e.on(v,t=>{m(t)}),setTimeout(async()=>{if(!p){if(b)return;if(o){const t=await S({licenseKey:o,pluginName:i,baseApiUrl:c});t&&m(t)}else r("The `licenseKey` option not provided")}},2e3)}async function S(e){const{licenseKey:s,pluginName:i,baseApiUrl:o}=e;try{return(await L({baseApiUrl:o,path:`/sdk/${s||"na"}`,method:"POST",params:{d:window.location.hostname,pn:i}})).result||{}}catch(a){return console.error("Error during SDK license check:",a),!1}}const x="linkImageComponent",O=f.startup;return _(function(e,s={}){const{Components:i,Blocks:o}=e,a="link-image",c="Link Image",p="link-image",{model:b,view:r}=e.Components.getType("image"),m=i.getType("link").model.getDefaults().traits,t=b.getDefaults().traits,l=m.filter(n=>n!=="title"),y=t.filter(n=>n.name!=="customAttributes").map(n=>typeof n=="string"?{name:n}:n).map(n=>({...n,getValue({component:d}){var u;return(u=d.components().at(0).getTrait(n.name))==null?void 0:u.getValue()},setValue({component:d,value:u,options:T}){var w;(w=d.components().at(0).getTrait(n.name))==null||w.setValue(u,T)}}));i.addType(a,{isComponent:n=>{var d;return n.tagName==="A"&&((d=n.children)==null?void 0:d.length)===1&&n.children[0].tagName==="IMG"},block:{label:c,media:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M2 6.3A2.3 2.3 0 0 1 4.3 4h15.4A2.3 2.3 0 0 1 22 6.3v7a4.7 4.7 0 0 0-2.8-.8h-3.4a4.8 4.8 0 0 0-4 7.5H4.3A2.3 2.3 0 0 1 2 17.7zm21 11a3.8 3.8 0 0 0-3.8-3.8.8.8 0 0 0 0 1.5h.2a2.3 2.3 0 0 1-.1 4.5H19a.8.8 0 0 0 .2 1.5h.2a3.8 3.8 0 0 0 3.5-3.8m-6.5-3a.8.8 0 0 0-.8-.7h-.1a3.8 3.8 0 0 0 .2 7.5.8.8 0 0 0 0-1.5h-.2a2.3 2.3 0 0 1 .2-4.5.8.8 0 0 0 .7-.7m3.5 3a.8.8 0 0 0-.8-.8h-3.6a.8.8 0 0 0 .2 1.5h3.6a.8.8 0 0 0 .6-.8"/></svg>'},extend:"link",extendFn:["init"],model:{defaults:{name:c,classes:p,resizable:{ratioDefault:!0},traits:[...y,...l],droppable:!1,stylable:["width","min-width","max-width","height","min-height","max-height","padding","margin","position","border-radius","border-width","border-style","border-color","opacity","box-shadow","filter","transform"],components:{type:"image"},styles:`
          .${p} {
            display: inline-block;
            overflow: hidden;
          }
          .${p} > img {
            object-fit: cover;
            display: block;
            width: 100%;
            height: 100%;
          }
        `},init(){const n=this.components().at(0);n==null||n.set({layerable:!1,locked:!0})}},view:{onActive(n){r.prototype.onActive.call(this,n)}}}),P({editor:e,licenseKey:s.licenseKey,plan:O,pluginName:x,cleanup:()=>{i.removeType(a),o.remove(a)}})})});
