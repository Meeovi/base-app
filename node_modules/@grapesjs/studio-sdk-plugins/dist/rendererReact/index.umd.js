(function(m,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("react/jsx-runtime"),require("react"),require("react-dom/client")):typeof define=="function"&&define.amd?define(["react/jsx-runtime","react","react-dom/client"],h):(m=typeof globalThis<"u"?globalThis:m||self,m.StudioSdkPlugins_rendererReact=h(m.jsxRuntime,m.React,m.ReactDOMClient))})(this,function(m,h,U){"use strict";const S="app.grapesjs.com",R="app-stage.grapesjs.com",N=[S,"app2.grapesjs.com",R,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],j="license:check:start",W="license:check:end",M=()=>typeof window<"u",B=({isDev:e,isStage:t})=>`${e?"":`https://${t?R:S}`}/api`,$=()=>{const e=M()&&window.location.hostname;return!!e&&(N.includes(e)||N.some(t=>e.endsWith(t)))},F=e=>e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(t,n)=>(n?"-":"")+t.toLowerCase()),T=e=>typeof e=="string";function K(e){return typeof e=="function"}async function V({path:e,baseApiUrl:t,method:n="GET",headers:s={},params:r,body:o}){const c=`${t||B({isDev:!1,isStage:!1})}${e}`,a={method:n,headers:{"Content-Type":"application/json",...s}};o&&(a.body=JSON.stringify(o));const d=r?new URLSearchParams(r).toString():"",l=d?`?${d}`:"",u=await fetch(`${c}${l}`,a);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return u.json()}var v=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(v||{});const x={[v.free]:0,[v.startup]:10,[v.business]:20,[v.enterprise]:30};function z(e){const t=e;return t.init=n=>s=>e(s,n),t}const q=e=>z(e);async function G({editor:e,plan:t,pluginName:n,licenseKey:s,cleanup:r}){let o="",i=!1;const c=$(),a=l=>{console.warn("Cleanup plugin:",n,"Reason:",l),r()},d=(l={})=>{var g;const{error:u,sdkLicense:y}=l,f=(g=l.plan)==null?void 0:g.category;if(!(y||l.license)||u)a(u||"Invalid license");else if(f){const A=x[t],w=x[f];A>w&&a({pluginRequiredPlan:t,licensePlan:f})}};e.on(j,l=>{o=l==null?void 0:l.baseApiUrl,i=!0}),e.on(W,l=>{d(l)}),setTimeout(async()=>{if(!i){if(c)return;if(s){const l=await J({licenseKey:s,pluginName:n,baseApiUrl:o});l&&d(l)}else a("The `licenseKey` option not provided")}},2e3)}async function J(e){const{licenseKey:t,pluginName:n,baseApiUrl:s}=e;try{return(await V({baseApiUrl:s,path:`/sdk/${t||"na"}`,method:"POST",params:{d:window.location.hostname,pn:n}})).result||{}}catch(r){return console.error("Error during SDK license check:",r),!1}}function H(e){const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const s=F(n);t[s]=e[n]}return t}const Z=(e,t)=>{const n=e.components||{};for(const s in n){const r=n[s];if(r.component===t)return{cmpConfig:r,type:s}}};function O(e){const t={};let n=!1;for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const r=e[s];if(typeof r=="string"||typeof r=="number"){const o=s.includes("-")?s.replace(/-([a-z])/g,i=>i[1].toUpperCase()):s;t[o]=r,n=!0}}return n?t:void 0}function Q(e){const t={};return e.split(";").forEach(n=>{if(!n.trim())return;const s=n.indexOf(":");if(s>0){const r=n.substring(0,s).trim(),o=n.substring(s+1).trim();if(r&&o){const i=r.replace(/-([a-z])/g,c=>c[1].toUpperCase());t[i]=o}}}),Object.keys(t).length>0?t:void 0}function X(e){if(e){if(typeof e=="object"&&!Array.isArray(e))return O(e);if(typeof e=="string"){let t=Q(e);if(!t)try{const n=JSON.parse(e);typeof n=="object"&&n!==null&&!Array.isArray(n)&&(t=O(n))}catch(n){console.error("Failed to parse style string as JSON",n)}return t}if(Array.isArray(e)){const t={};return e.forEach(n=>{if(typeof n=="object"&&n!==null){const s=n.name||n.property,r=n.value;if(typeof s=="string"&&s&&r!==void 0&&r!==""){const o=s.replace(/-([a-z])/g,i=>i[1].toUpperCase());t[o]=r}}}),Object.keys(t).length>0?t:void 0}}}function Y(e){return P[e]?P[e]:e.includes("-")?e.replace(/-([a-z])/g,(t,n)=>n.toUpperCase()):e}function ee(e){var n;const t={};for(const[s,r]of Object.entries(e))if(s==="style")t.style=X(r);else if(s.startsWith("data-"))t[s]=r;else{const o=Y(s);((n=e.xmlns)==null?void 0:n.includes("svg"))||e.viewBox!==void 0||e.d!==void 0||ne.has(o)||o.startsWith("svg")?t[o]=r:!te.has(o)&&!o.startsWith("on")&&!o.startsWith("aria-")&&!o.startsWith("data-")?t[s]=r:t[o]=r}return t}const te=new Set(["className","id","style","href","src","alt","title","target","rel","type","name","value","placeholder","onClick","onChange","onSubmit","onBlur","onFocus","disabled","readOnly","checked","selected","multiple","width","height","maxLength","min","max","step","rows","cols","autoComplete","autoFocus","required","spellCheck","tabIndex","aria-label","aria-labelledby","aria-describedby","role"]),ne=new Set(["x","y","d","cx","cy","r","rx","ry","x1","x2","y1","y2","points","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","strokeDasharray","strokeOpacity","fillOpacity","fillRule","clipRule","transform","viewBox","preserveAspectRatio","pathLength","vectorEffect","dominantBaseline","alignmentBaseline","textAnchor","fontFamily","fontSize","fontStyle","fontWeight","textDecoration","baselineShift","opacity","mask","clipPath","overflow","pointerEvents"]),P={class:"className",for:"htmlFor","http-equiv":"httpEquiv","accept-charset":"acceptCharset","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-linejoin":"strokeLinejoin","fill-rule":"fillRule","clip-rule":"clipRule","stroke-miterlimit":"strokeMiterlimit","stroke-dasharray":"strokeDasharray","stroke-opacity":"strokeOpacity","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","text-anchor":"textAnchor"},b=e=>(e==null?void 0:e.$$typeof)&&typeof e.props=="object";function oe(e){return t=>{const n=t.getContent();b(n)&&t.set({content:k({...e,model:n}),reactContent:n})}}const se=e=>t=>{const n=t.component;b(n)&&(t.component={components:k({...e,model:n})})};function k(e){const{model:t,editor:n,config:s}=e;if(b(t)){const r=t,o={},{type:i,props:c={}}=r,{children:a,className:d,style:l,...u}=c,y=p=>({type:"textnode",content:p}),f=typeof i=="symbol";if(K(i)){const p=Z(s,i);o.type=p==null?void 0:p.type}else n.Components.getType(i)?o.type=i:f||(o.tagName=i);if(d&&(o.classes=d),l&&(o.style=H(l)),Array.isArray(a)?o.components=a.map(p=>T(p)?y(p):k({...e,model:p})).filter(Boolean):T(a)&&(o.components=y(a)),Object.keys(u).length){const p=n.Parser.parserHtml.splitPropsFromAttr(u);o.attributes=p.attrs,Object.assign(o,p.props)}return o}}function re(e){const{component:t}=e,[n,s]=h.useState(0),[r,o]=h.useState();return h.useEffect(()=>{if(!t)return()=>{};const c=()=>s(p=>p+1),a=()=>{[...t.views].forEach(g=>g.remove()),o(void 0)},{em:d}=t,l=d.Components.events,y=[...["components","attributes","classes"].map(p=>`${l.update}:${p}`),"rerender"].join(" "),f=[l.removed,"rerender"].join(" ");return t.on(y,c),t.on(f,a),()=>{t.off(y,c),t.off(f,a),a()}},[t]),{key:n,view:r,connectDom:c=>{if(!c)return;const a=ce({...e,el:c});o(a)}}}function ce(e){var a;const{editor:t,component:n,el:s,frameView:r}=e,{em:o,Components:i}=t;let c=n.getView(r.model);if((c==null?void 0:c.el)===s)return c;if(!c){const{ComponentView:d}=i,l=n.attributes.type||"default",u=((a=i.getType(l))==null?void 0:a.view)||d,y={...i.config,frameView:r,em:o},f=u.extend({initComponents(){},_createElement(){return s},_removeElement(){},__clearAttributes(){},render(){var p;return this._ensureElement(),this._setData(),this.renderAttributes(),(p=this.updateSrc)==null||p.call(this),this}});c=new f({el:s,config:y,model:n})}return c.el=s,c.render(),c}function ie(e,t){const{Components:n}=e,s=r=>{const{id:o,model:i}=r;n.addType(o,{model:{toJSON(...c){const a=i.prototype.toJSON.apply(this,c);return a.tagName=this.tagName,a}}})};n.getTypes().forEach(s),e.on("component:type:add",s),Object.entries(t.components||{}).forEach(([r,o])=>{var y,f;const{allowPropClassName:i,allowPropId:c,allowChildren:a}=o,d=!c&&!i,l=()=>({disabled:d}),u=()=>({disableClasses:!i,disableComponent:!c});n.addType(r,{isComponent:p=>(p==null?void 0:p.tagName)===r,model:{defaults:{type:r,traits:((y=o.props)==null?void 0:y.call(o))||[],droppable:!!a,stylable:!d,styleManager:l,selectorManager:u,...((f=o.model)==null?void 0:f.defaults)||{}}}})})}function D(e){var I;const{component:t,config:n,editor:s,frameView:r,onMount:o,tagName:i,children:c}=e,{key:a,view:d,connectDom:l}=re(e);h.useEffect(()=>{if(!d&&!o)return;const C=setTimeout(()=>{d&&(o==null||o(d),setTimeout(()=>d.postRender()))});return()=>clearTimeout(C)},[d]);const u=t.get("type")||"default",y=t.content,f=(I=n.components)==null?void 0:I[u],p=(f==null?void 0:f.component)||i||t.tagName||"div",g=t.components(),A=g.length?g.map(C=>m.jsx(D,{component:C,config:n,editor:s,frameView:r},C.cid)):[y||void 0],w=ee(t.getAttributes()),_=f==null?void 0:f.editorRender,L=[...A,c].filter(C=>C??!1),E=L.length?L:null;if(_)return m.jsx(_,{props:w,editor:s,component:t,connectDom:l,children:E});if(f!=null&&f.component)return m.jsx("gjs-wrapper",{ref:l,style:f.wrapperStyle,children:m.jsx(p,{...w,children:E})});if(t.isInstanceOf("textnode"))return y;const fe=t.isInstanceOf("text")?a:void 0;return h.createElement(p,{...w,ref:l,key:fe},t.get("void")?null:E)}const ae=e=>{const{frame:t,window:n,onMount:s,editor:r}=e,o=r.Canvas.events,{root:i}=t;try{const c=U.createRoot(n.document.body);c.render(m.jsx(le,{...e,component:i,onMount:s}));const a=()=>c.unmount();t.once(o.frameUnload,a),n.addEventListener("unload",a)}catch(c){console.warn(c)}return i.getView()};function le(e){const{editor:t,component:n,window:s,frameView:r,config:o,onMount:i}=e,c=s.document,a=o.rootComponent||h.Fragment,d=o.rootComponent?{editorProps:{doc:c,editor:t,frameView:r}}:{},l=(o==null?void 0:o.bodyAfter)||h.Fragment;return m.jsx(a,{...d,children:m.jsx(D,{tagName:"div",component:n,config:o,editor:t,frameView:r,onMount:i,children:m.jsx(l,{...d})})})}const pe="rendererReact",de=v.startup;return q(function(e,t={}){const{Blocks:n,Pages:s}=e,r=n.events,o=s.events;e.Canvas.config.customRenderer=c=>ae({...c,config:t}),e.Components.config.processor=c=>k({model:c,editor:e,config:t}),ie(e,t);const i=[[r.add,oe({editor:e,config:t})],[o.addBefore,se({editor:e,config:t})]];i.forEach(([c,a])=>e.on(c,a)),G({editor:e,licenseKey:t.licenseKey,plan:de,pluginName:pe,cleanup:()=>{e.Canvas.config.customRenderer=void 0,e.Components.config.processor=void 0,i.forEach(([c,a])=>e.off(c,a))}})})});
