(function(S,w){typeof exports=="object"&&typeof module<"u"?module.exports=w():typeof define=="function"&&define.amd?define(w):(S=typeof globalThis<"u"?globalThis:S||self,S.StudioSdkPlugins_canvasFullSize=w())})(this,function(){"use strict";function S(e,a,t){let s,o,c,h,d;const r=a;function m(){const l=Date.now()-h;l<r&&l>=0?s=setTimeout(m,r-l):(s=null,d=e.apply(c,o),c=o=null)}const i=function(){return c=this,o=arguments,h=Date.now(),s||(s=setTimeout(m,r)),d};return i.clear=function(){s&&(clearTimeout(s),s=null)},i.flush=function(){s&&(d=e.apply(c,o),c=o=null,clearTimeout(s),s=null)},i}const w="app.grapesjs.com",P="app-stage.grapesjs.com",I=[w,"app2.grapesjs.com",P,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],W="license:check:start",F="license:check:end",G=()=>typeof window<"u",K=({isDev:e,isStage:a})=>`${e?"":`https://${a?P:w}`}/api`,Z=()=>{const e=G()&&window.location.hostname;return!!e&&(I.includes(e)||I.some(a=>e.endsWith(a)))};async function q({path:e,baseApiUrl:a,method:t="GET",headers:s={},params:o,body:c}){const d=`${a||K({isDev:!1,isStage:!1})}${e}`,r={method:t,headers:{"Content-Type":"application/json",...s}};c&&(r.body=JSON.stringify(c));const m=o?new URLSearchParams(o).toString():"",i=m?`?${m}`:"",l=await fetch(`${d}${i}`,r);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return l.json()}var y=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(y||{});const N={[y.free]:0,[y.startup]:10,[y.business]:20,[y.enterprise]:30};function B(e){const a=e;return a.init=t=>s=>e(s,t),a}const X=e=>B(e);async function Y({editor:e,plan:a,pluginName:t,licenseKey:s,cleanup:o}){let c="",h=!1;const d=Z(),r=i=>{console.warn("Cleanup plugin:",t,"Reason:",i),o()},m=(i={})=>{var v;const{error:l,sdkLicense:g}=i,b=(v=i.plan)==null?void 0:v.category;if(!(g||i.license)||l)r(l||"Invalid license");else if(b){const E=N[a],$=N[b];E>$&&r({pluginRequiredPlan:a,licensePlan:b})}};e.on(W,i=>{c=i==null?void 0:i.baseApiUrl,h=!0}),e.on(F,i=>{m(i)}),setTimeout(async()=>{if(!h){if(d)return;if(s){const i=await J({licenseKey:s,pluginName:t,baseApiUrl:c});i&&m(i)}else r("The `licenseKey` option not provided")}},2e3)}async function J(e){const{licenseKey:a,pluginName:t,baseApiUrl:s}=e;try{return(await q({baseApiUrl:s,path:`/sdk/${a||"na"}`,method:"POST",params:{d:window.location.hostname,pn:t}})).result||{}}catch(o){return console.error("Error during SDK license check:",o),!1}}const O="data-gs-plg-",R="canvasFullSize",Q=y.startup,ee=(e,a)=>{const{rule:t,ruleView:s}=a,{style:o}=t.attributes;if(o&&o[e]){const c=o[e],h=/([0-9.]+)(vh|dvh|lvh|svh)/g,d=h.test(c),r=s.frameView.model;if(d&&r.hasAutoHeight()){const m=c.replace(h,(l,g)=>`${window.innerHeight*(parseFloat(g)/100)}px`),i=t.toCSS({style:{...o,[e]:m}});a.css=i}}},te=e=>{["height","min-height","max-height"].forEach(a=>ee(a,e))};return X(function(e,a={}){const{Canvas:t,Commands:s,Devices:o,Css:c}=e,h={deviceMaxWidth:1200,deviceMinHeigth:500,canvasOffsetY:30,canvasOffsetX:50,canvasTransition:.3,frameBorderRadius:5,frameTransition:.3,...a},{canvasOffsetY:d,canvasOffsetX:r,canvasTransition:m,deviceMaxWidth:i,deviceMinHeigth:l,deviceFixedHeight:g,frameBorderRadius:b,frameTransition:j}=h,v=`${l}px`,E=t.events,$="core:preview",ne=`${s.events.stopCommand}${$}`,M=t.getConfig(),V=`${R}:disable`,se=o.getAll().map(n=>({...n.attributes})),oe=m*1e3,H={x:r,y:d};let C={},L,T;M.scrollableCanvas=!g,o.getAll().map(n=>{!n.get("width")&&n.set("width",`${i}px`),!n.get("height")&&n.set("height",g?"100vh":"auto"),!n.get("minHeight")&&n.set("minHeight",v)});const _=n=>{const u=`${O}canvas-full-size`,p=document.querySelector(`style[${u}]`);if(n&&p)return p.remove();const f=p||document.createElement("style"),D=t.getZoomMultiplier();f.setAttribute(u,"true"),f.innerHTML=`
      .gjs-frame-wrapper { transition: width ${j}s !important; }
      .gjs-frame-wrapper__bottom { height: ${d*D}px }
      .gjs-frame { border-radius: ${b}px }
    `,!p&&document.body.appendChild(f)};e.on(E.frameLoadHead,n=>{if(!M.scrollableCanvas)return;const{window:u}=n,p=u.document,f=p.head,D=`${O}canvas-full-size-wrappers`,x=f.querySelector(`style[${D}]`)||p.createElement("style");x.setAttribute(D,"true"),x.innerHTML=`
      body { height: auto !important; }
      [data-gjs-type="wrapper"] { min-height: ${v} !important; }
      [data-gjs-type="mjml"] { min-height: ${v} !important; }
      [data-gjs-type="mj-body"] { min-height: ${v} !important; }
    `,!f.contains(x)&&f.appendChild(x)});const U=()=>L.style.display="none",ie=()=>L.style.display="",ae=()=>{var f;if(!g)return;const n=t.getZoomMultiplier(),p=t.getRect().height*n-d*2;(f=o.getSelected())==null||f.set("height",`${Math.max(p,l)}px`),t.fitViewport({zoom:t.getZoom(),gap:H})},A=S(()=>{t.fitViewport({zoom:n=>n>100?100:n,ignoreHeight:!0,gap:H}),ae(),_(),setTimeout(()=>{var u,p;const{em:n}=e;n.destroyed||((p=(u=e.getSelected())==null?void 0:u.getEl())==null||p.scrollIntoView({block:"nearest"}),e.refresh({tools:!0}),ie(),s.isActive($)?n.stopDefault():n.runDefault())},oe)},100),ce=(n={})=>{n.options&&n.options.from!=="fitViewport"&&t.fitViewport({zoom:t.getZoom(),ignoreHeight:!0,gap:H})},re=()=>{U(),A()},le=()=>{C.overflowX="hidden",C.overflowY="auto"},k=()=>{T==null||T.disconnect(),A.clear()},z=[[o.events.select,re],[E.zoom,ce],[ne,le],[e.events.destroy,k],[c.events.mountBefore,te]];s.add(V,()=>{o.devices.reset(se),M.scrollableCanvas=!1,t.getModel().updateDevice(),t.setZoom(100),t.setCoords(0,0),C.overflowY="hidden",_(!0),z.forEach(([n,u])=>e.off(n,u)),k(),s.run("studio:canvasReload")}),z.forEach(([n,u])=>e.on(n,u)),e.onReady(()=>{const n=t.getElement(),u=t.getFramesEl(),p=t.getCanvasView();L=t.getSpotsEl(),C=n.style,C.overflowX="hidden",u.style.transition=`transform ${m}s`,document.removeEventListener("keypress",p.onKeyPress),_(),T=new ResizeObserver(()=>{U(),A()}),T.observe(n.parentElement),A()}),Y({editor:e,licenseKey:h.licenseKey,plan:Q,pluginName:R,cleanup:()=>{e.runCommand(V)}})})});
