"use strict";function X(e,i,t){let s,o,c,h,m;const r=i;function d(){const l=Date.now()-h;l<r&&l>=0?s=setTimeout(d,r-l):(s=null,m=e.apply(c,o),c=o=null)}const a=function(){return c=this,o=arguments,h=Date.now(),s||(s=setTimeout(d,r)),m};return a.clear=function(){s&&(clearTimeout(s),s=null)},a.flush=function(){s&&(m=e.apply(c,o),c=o=null,clearTimeout(s),s=null)},a}const U="app.grapesjs.com",k="app-stage.grapesjs.com",Y="app2.grapesjs.com",J="app-stage2.grapesjs.com",j=[U,Y,k,J,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],Q="license:check:start",ee="license:check:end",te=()=>typeof window<"u",ne=({isDev:e,isStage:i})=>`${e?"":`https://${i?k:U}`}/api`,se=()=>{const e=te()&&window.location.hostname;return!!e&&(j.includes(e)||j.some(i=>e.endsWith(i)))};async function oe({path:e,baseApiUrl:i,method:t="GET",headers:s={},params:o,body:c}){const m=`${i||ne({isDev:!1,isStage:!1})}${e}`,r={method:t,headers:{"Content-Type":"application/json",...s}};c&&(r.body=JSON.stringify(c));const d=o?new URLSearchParams(o).toString():"",a=d?`?${d}`:"",l=await fetch(`${m}${a}`,r);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return l.json()}var y=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(y||{});const I={[y.free]:0,[y.startup]:10,[y.business]:20,[y.enterprise]:30};function ae(e){const i=e;return i.init=t=>s=>e(s,t),i}const ie=e=>ae(e);async function ce({editor:e,plan:i,pluginName:t,licenseKey:s,cleanup:o}){let c="",h=!1;const m=se(),r=a=>{console.warn("Cleanup plugin:",t,"Reason:",a),o()},d=(a={})=>{var v;const{error:l,sdkLicense:g}=a,w=(v=a.plan)==null?void 0:v.category;if(!(g||a.license)||l)r(l||"Invalid license");else if(w){const S=I[i],E=I[w];S>E&&r({pluginRequiredPlan:i,licensePlan:w})}};e.on(Q,a=>{c=a==null?void 0:a.baseApiUrl,h=!0}),e.on(ee,a=>{d(a)}),setTimeout(async()=>{if(!h){if(m)return;if(s){const a=await re({licenseKey:s,pluginName:t,baseApiUrl:c});a&&d(a)}else r("The `licenseKey` option not provided")}},2e3)}async function re(e){const{licenseKey:i,pluginName:t,baseApiUrl:s}=e;try{return(await oe({baseApiUrl:s,path:`/sdk/${i||"na"}`,method:"POST",params:{d:window.location.hostname,pn:t}})).result||{}}catch(o){return console.error("Error during SDK license check:",o),!1}}const N="data-gs-plg-",O="canvasFullSize",le=y.startup,ue=(e,i)=>{const{rule:t,ruleView:s}=i,{style:o}=t.attributes;if(o&&o[e]){const c=o[e],h=/([0-9.]+)(vh|dvh|lvh|svh)/g,m=h.test(c),r=s.frameView.model;if(m&&r.hasAutoHeight()){const d=c.replace(h,(l,g)=>`${window.innerHeight*(parseFloat(g)/100)}px`),a=t.toCSS({style:{...o,[e]:d}});i.css=a}}},pe=e=>{["height","min-height","max-height"].forEach(i=>ue(i,e))},me=function(e,i={}){const{Canvas:t,Commands:s,Devices:o,Css:c}=e,h={deviceMaxWidth:1200,deviceMinHeigth:500,canvasOffsetY:30,canvasOffsetX:50,canvasTransition:.3,frameBorderRadius:5,frameTransition:.3,...i},{canvasOffsetY:m,canvasOffsetX:r,canvasTransition:d,deviceMaxWidth:a,deviceMinHeigth:l,deviceFixedHeight:g,frameBorderRadius:w,frameTransition:M}=h,v=`${l}px`,S=t.events,E="core:preview",W=`${s.events.stopCommand}${E}`,D=t.getConfig(),P=`${O}:disable`,z=o.getAll().map(n=>({...n.attributes})),F=d*1e3,x={x:r,y:m};let b={},H,C;D.scrollableCanvas=!g,o.getAll().map(n=>{!n.get("width")&&n.set("width",`${a}px`),!n.get("height")&&n.set("height",g?"100vh":"auto"),!n.get("minHeight")&&n.set("minHeight",v)});const L=n=>{const u=`${N}canvas-full-size`,p=document.querySelector(`style[${u}]`);if(n&&p)return p.remove();const f=p||document.createElement("style"),T=t.getZoomMultiplier();f.setAttribute(u,"true"),f.innerHTML=`
      .gjs-frame-wrapper { transition: width ${M}s !important; }
      .gjs-frame-wrapper__bottom { height: ${m*T}px }
      .gjs-frame { border-radius: ${w}px }
    `,!p&&document.body.appendChild(f)};e.on(S.frameLoadHead,n=>{if(!D.scrollableCanvas)return;const{window:u}=n,p=u.document,f=p.head,T=`${N}canvas-full-size-wrappers`,A=f.querySelector(`style[${T}]`)||p.createElement("style");A.setAttribute(T,"true"),A.innerHTML=`
      body { height: auto !important; }
      [data-gjs-type="wrapper"] { min-height: ${v} !important; }
      [data-gjs-type="mjml"] { min-height: ${v} !important; }
      [data-gjs-type="mj-body"] { min-height: ${v} !important; }
    `,!f.contains(A)&&f.appendChild(A)});const R=()=>H.style.display="none",K=()=>H.style.display="",G=()=>{var f;if(!g)return;const n=t.getZoomMultiplier(),p=t.getRect().height*n-m*2;(f=o.getSelected())==null||f.set("height",`${Math.max(p,l)}px`),t.fitViewport({zoom:t.getZoom(),gap:x})},$=X(()=>{t.fitViewport({zoom:n=>n>100?100:n,ignoreHeight:!0,gap:x}),G(),L(),setTimeout(()=>{var u,p;const{em:n}=e;n.destroyed||((p=(u=e.getSelected())==null?void 0:u.getEl())==null||p.scrollIntoView({block:"nearest"}),e.refresh({tools:!0}),K(),s.isActive(E)?n.stopDefault():n.runDefault())},F)},100),Z=(n={})=>{n.options&&n.options.from!=="fitViewport"&&t.fitViewport({zoom:t.getZoom(),ignoreHeight:!0,gap:x})},q=()=>{R(),$()},B=()=>{b.overflowX="hidden",b.overflowY="auto"},V=()=>{C==null||C.disconnect(),$.clear()},_=[[o.events.select,q],[S.zoom,Z],[W,B],[e.events.destroy,V],[c.events.mountBefore,pe]];s.add(P,()=>{o.devices.reset(z),D.scrollableCanvas=!1,t.getModel().updateDevice(),t.setZoom(100),t.setCoords(0,0),b.overflowY="hidden",L(!0),_.forEach(([n,u])=>e.off(n,u)),V(),s.run("studio:canvasReload")}),_.forEach(([n,u])=>e.on(n,u)),e.onReady(()=>{const n=t.getElement(),u=t.getFramesEl(),p=t.getCanvasView();H=t.getSpotsEl(),b=n.style,b.overflowX="hidden",u.style.transition=`transform ${d}s`,document.removeEventListener("keypress",p.onKeyPress),L(),C=new ResizeObserver(()=>{R(),$()}),C.observe(n.parentElement),$()}),ce({editor:e,licenseKey:h.licenseKey,plan:le,pluginName:O,cleanup:()=>{e.runCommand(P)}})},de=ie(me);module.exports=de;
