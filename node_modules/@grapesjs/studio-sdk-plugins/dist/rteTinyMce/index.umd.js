(function(p,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(p=typeof globalThis<"u"?globalThis:p||self,p.StudioSdkPlugins_rteTinyMce=h())})(this,function(){"use strict";var p=(t=>(t.free="free",t.startup="startup",t.business="business",t.enterprise="enterprise",t))(p||{}),h=(t=>(t.toastAdd="studio:toastAdd",t.toastRemove="studio:toastRemove",t.dialogOpen="studio:dialogOpen",t.dialogClose="studio:dialogClose",t.dialogExportCode="studio:dialogExportCode",t.sidebarLeftSet="studio:sidebarLeft:set",t.sidebarLeftGet="studio:sidebarLeft:get",t.sidebarLeftToggle="studio:sidebarLeft:toggle",t.sidebarRightSet="studio:sidebarRight:set",t.sidebarRightGet="studio:sidebarRight:get",t.sidebarRightToggle="studio:sidebarRight:toggle",t.sidebarTopSet="studio:sidebarTop:set",t.sidebarTopGet="studio:sidebarTop:get",t.sidebarTopToggle="studio:sidebarTop:toggle",t.sidebarBottomSet="studio:sidebarBottom:set",t.sidebarBottomGet="studio:sidebarBottom:get",t.sidebarBottomToggle="studio:sidebarBottom:toggle",t.symbolAdd="studio:symbolAdd",t.symbolDetach="studio:symbolDetach",t.symbolOverride="studio:symbolOverride",t.symbolPropagateStyles="studio:propagateStyles",t.getPagesConfig="studio:getPagesConfig",t.setPagesConfig="studio:setPagesConfig",t.getPageSettings="studio:getPageSettings",t.setPageSettings="studio:setPageSettings",t.clearPage="studio:clearPage",t.projectFiles="studio:projectFiles",t.validateCode="studio:validateCode",t.canvasReload="studio:canvasReload",t.getBlocksPanel="studio:getBlocksPanel",t.setBlocksPanel="studio:setBlocksPanel",t.getStateContextMenu="studio:getStateContextMenu",t.setStateContextMenu="studio:setStateContextMenu",t.contextMenuComponent="studio:contextMenuComponent",t.layoutAdd="studio:layoutAdd",t.layoutRemove="studio:layoutRemove",t.layoutToggle="studio:layoutToggle",t.layoutUpdate="studio:layoutUpdate",t.layoutGet="studio:layoutGet",t.layoutConfigGet="studio:layoutConfigGet",t.layoutConfigSet="studio:layoutConfigSet",t.getStateTheme="studio:getStateTheme",t.setStateTheme="studio:setStateTheme",t.assetProviderGet="studio:assetProviderGet",t.assetProviderAdd="studio:assetProviderAdd",t.assetProviderRemove="studio:assetProviderRemove",t.fontGet="studio:fontGet",t.fontAdd="studio:fontAdd",t.fontRemove="studio:fontRemove",t.fontManagerOpen="studio:fontManagerOpen",t.menuFontLoad="studio:menuFontLoad",t.toggleStateDataSource="studio:toggleStateDataSource",t.getStateDataSource="studio:getStateDataSource",t.dataSourceSetGlobalData="studio:dataSourceSetGlobalData",t.dataSourceSetImporter="studio:dataSourceSetImporter",t.dataSourceSetExporter="studio:dataSourceSetExporter",t.setDragAbsolute="studio:setDragAbsolute",t))(h||{}),E=(t=>(t.dark="dark",t.light="light",t.auto="auto",t))(E||{});const k="app.grapesjs.com",R="app-stage.grapesjs.com",P=[k,"app2.grapesjs.com",R,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],I="license:check:start",M="license:check:end",G=()=>typeof window<"u",N=({isDev:t,isStage:n})=>`${t?"":`https://${n?R:k}`}/api`,B=()=>{const t=G()&&window.location.hostname;return!!t&&(P.includes(t)||P.some(n=>t.endsWith(n)))};async function S({path:t,baseApiUrl:n,method:o="GET",headers:s={},params:a,body:l}){const c=`${n||N({isDev:!1,isStage:!1})}${t}`,r={method:o,headers:{"Content-Type":"application/json",...s}};l&&(r.body=JSON.stringify(l));const b=a?new URLSearchParams(a).toString():"",e=b?`?${b}`:"",i=await fetch(`${c}${e}`,r);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return i.json()}const _={[p.free]:0,[p.startup]:10,[p.business]:20,[p.enterprise]:30};function j(t){const n=t;return n.init=o=>s=>t(s,o),n}const U=t=>j(t);async function W({editor:t,plan:n,pluginName:o,licenseKey:s,cleanup:a}){let l="",d=!1;const c=B(),r=e=>{console.warn("Cleanup plugin:",o,"Reason:",e),a()},b=(e={})=>{var v;const{error:i,sdkLicense:x}=e,u=(v=e.plan)==null?void 0:v.category;if(!(x||e.license)||i)r(i||"Invalid license");else if(u){const L=_[n],f=_[u];L>f&&r({pluginRequiredPlan:n,licensePlan:u})}};t.on(I,e=>{l=e==null?void 0:e.baseApiUrl,d=!0}),t.on(M,e=>{b(e)}),setTimeout(async()=>{if(!d){if(c)return;if(s){const e=await F({licenseKey:s,pluginName:o,baseApiUrl:l});e&&b(e)}else r("The `licenseKey` option not provided")}},2e3)}async function F(t){const{licenseKey:n,pluginName:o,baseApiUrl:s}=t;try{return(await S({baseApiUrl:s,path:`/sdk/${n||"na"}`,method:"POST",params:{d:window.location.hostname,pn:o}})).result||{}}catch(a){return console.error("Error during SDK license check:",a),!1}}const $=(t,n,o)=>{const{doc:s=document}=o,a=o.target||s.head,l=a.querySelector(`style[${t}]`)||s.createElement("style");l.setAttribute(t,"true"),l.innerHTML=n,!a.contains(l)&&a.appendChild(l)},C=t=>t.dispatchEvent(new CustomEvent("input"));function K(t,n){if(!n)return()=>{};const o=t.Components.events,s=e=>t.getSelectedAll().includes(e),a=e=>e.isInstanceOf("text")&&!e.isChildOf("text"),l=e=>e.isChildOf("text"),d=e=>t.getEditing()===e,c=(e,i={})=>{e.trigger("focus",i.event)},r=(e,i)=>{s(e)&&a(e)&&!d(e)&&c(e,i)},b=(e,i)=>{if(s(e)&&!a(e)&&l(e)){const x=e.parents().find(u=>u.isInstanceOf("text"));x&&(c(x,i),setTimeout(()=>t.select(x),0))}};return t.on(o.select,r),t.on(o.selectBefore,b),()=>{t.off(o.select,r),t.off(o.selectBefore,b)}}const q="rteTinyMce",H=p.startup,z=`
.tox .tox-toolbar,
.tox .tox-toolbar__overflow,
.tox .tox-toolbar__primary,
.tox .tox-menu,
.tox .tox-dialog,
.tox .tox-toolbar-overlord,
.tox .tox-dialog__header,
.tox .tox-dialog__footer {
    background-color: var(--gs-theme-cl-glb-bg3);
    color: var(--gs-theme-cl-glb-txt);
}

.tox .tox-collection__item,
.tox .tox-label,
.tox .tox-toolbar-label {
    color: var(--gs-theme-cl-glb-txt);
}

.tox.tox-tinymce-inline .tox-editor-header {
    border-color: var(--gs-theme-cl-glb-br);
    background-color: var(--gs-theme-cl-glb-bg3);
}

.tox .tox-button {
    background-color: var(--gs-theme-cl-prm-bg1);
    border-color: var(--gs-theme-cl-prm-bg1);
}

.tox .tox-button:hover:not(:disabled) {
    background-color: var(--gs-theme-cl-prm-bgh);
    border-color: var(--gs-theme-cl-prm-bgh);
}

.tox .tox-button--secondary {
    background-color: var(--gs-theme-cl-glb-bg2);
    border-color: var(--gs-theme-cl-glb-br);
}

.tox .tox-button--secondary:hover:not(:disabled) {
    background-color: var(--gs-theme-cl-glb-bgh);
    border-color: var(--gs-theme-cl-glb-bgh);
}

.tox .tox-tbtn {
    color: currentColor;
}

.tox .tox-listboxfield .tox-listbox--select,
.tox .tox-textarea,
.tox .tox-tbtn--bespoke,
.tox .tox-textarea-wrap .tox-textarea:focus,
.tox .tox-textfield,
.tox .tox-toolbar-textfield {
    background-color: var(--gs-theme-cl-glb-bgh);
}

.tox .tox-custom-editor:focus-within,
.tox .tox-listboxfield .tox-listbox--select:focus,
.tox .tox-textarea-wrap:focus-within,
.tox .tox-textarea:focus,
.tox .tox-textfield:focus {
    background-color: var(--gs-theme-cl-glb-bgh);
    border-color: var(--gs-theme-cl-prm-bg1);
}

.tox .tox-tbtn:hover,
.tox .tox-tbtn--enabled,
.tox .tox-tbtn--enabled:hover,
.tox .tox-tbtn:active,
.tox .tox-tbtn:focus,
.tox .tox-swatches__picker-btn:hover,
.tox .tox-collection--list .tox-collection__item--enabled,
.tox .tox-collection--toolbar .tox-collection__item--enabled,
.tox .tox-split-button:focus {
    background-color: var(--gs-theme-cl-prm-bg1);
    color: var(--gs-theme-cl-prm-txt);
}

.tox .tox-collection--list .tox-collection__item--active,
.tox .tox-collection--toolbar .tox-collection__item--active {
    background-color: var(--gs-theme-cl-prm-bgh);
    color: var(--gs-theme-cl-prm-txt) !important;
}

.tox .tox-split-button:hover {
    box-shadow: 0 0 0 1px var(--gs-theme-cl-glb-bgh) inset;
}

.tox .tox-dialog__body-nav-item--active {
    color: var(--gs-theme-cl-prm-bg1);
    border-color: var(--gs-theme-cl-prm-bg1);
}

.tox .tox-tbtn svg,
.tox .tox-tbtn:hover svg {
    fill: currentColor;
}

.tox .tox-insert-table-picker .tox-insert-table-picker__selected {
    background-color: var(--gs-theme-cl-prm-bg1);
    border-color: var(--gs-theme-cl-prm-bg3);
    opacity: 0.75;
}`,w=new WeakMap,V=(t,n)=>{w.set(t,n)},J=t=>{w.delete(t)},T=t=>w.get(t),m=t=>{const n=t.target,o=n.closest(".tox"),s=n.matches(".ephox-snooker-resizer-bar");(o||s)&&t.stopPropagation()},D=t=>{t.stopPropagation(),t.preventDefault()},X=(t,n)=>{const o=t.getDoc(),s=t.getWin();if(n!=null&&n.event){const{event:a}=n,{clientX:l,clientY:d}=a;let c;if(o.caretRangeFromPoint)c=o.caretRangeFromPoint(l,d);else if(o.caretPositionFromPoint){const r=o.caretPositionFromPoint(l,d);c=o.createRange(),c==null||c.setStart(r.offsetNode,r.offset)}if(c){const r=s.getSelection();r==null||r.removeAllRanges(),r==null||r.addRange(c),t.selection.setRng(c)}}else t.execCommand("SelectAll")},Y=t=>{var b,e;const{el:n,editor:o,componentView:s}=t,a=o.runCommand(h.getStateTheme),l=s.model,d={target:n,inline:!0,skin:(a==null?void 0:a.theme)===E.dark?"oxide-dark":"oxide",menubar:!1,image_advtab:!0,paste_data_images:!0,statusbar:!1,branding:!1,forced_root_block:"div",plugins:"advlist autolink lists link image media table",toolbar_mode:"sliding",toolbar:"bold italic underline strikethrough forecolor backcolor alignleft aligncenter alignright alignjustify link image | fontfamily fontsize bullist numlist outdent indent table"},c=((e=(b=t.pluginOpts)==null?void 0:b.loadConfig)==null?void 0:e.call(b,{config:d,editor:o,componentView:s,component:l}))||{};return{...d,...c}},A=(t,n=document)=>new Promise((o,s)=>{const a=Array.isArray(t)?[...t]:[t],{head:l}=n,d=c=>{if(c.length){const r=n.createElement("script");r.src=c.shift(),r.onload=d.bind(null,c),r.onerror=s,l.appendChild(r)}else o()};d(a)});return U(function(t,n={}){const o={cdnScript:"https://cdn.jsdelivr.net/npm/tinymce@6.8.5/tinymce.min.js",...n},{cdnScript:s}=o,a=t.Canvas.events,l=!o.skipCustomTheme,d="gs-plg-tinymce-studio-theme",c=async(e,i)=>{const x=e.ownerDocument,u=x.defaultView,g=i==null?void 0:i.view;if(!u||!g){console.warn("Missing required data",{win:u,componentView:g});return}const v=Y({el:e,editor:t,componentView:g,pluginOpts:o}),f=(await u.tinymce.init(v))[0];if(!f)return;const Q=(await window.tinymce.init({...v,target:document.createElement("div")}))[0];return f.ui.show(),x.body.addEventListener("mousedown",m),document.body.addEventListener("mousedown",m),f.on("Change",()=>C(e)),f.on("blur",()=>f.ui.show()),f.on("OpenWindow",function(){var O;const y=(O=x.querySelector(".tox-dialog"))==null?void 0:O.closest(".tox");y&&(y==null?void 0:y.ownerDocument)!==document&&(document.body.appendChild(y),f.once("CloseWindow",()=>{y&&y.ownerDocument===document&&x.body.appendChild(y)}))}),e.addEventListener("dragstart",D,{capture:!0}),t.runCommand(h.setStateContextMenu,{enabled:!1}),X(f,i),{rteEditor:f,rteEditorShallow:Q}},r=(e,i)=>{e.ownerDocument.body.removeEventListener("mousedown",m),document.body.removeEventListener("mousedown",m),e.removeEventListener("dragstart",D,{capture:!0}),t.runCommand(h.setStateContextMenu,{enabled:!0}),i.rteEditor.destroy(),i.rteEditorShallow.destroy()};t.on(a.frameLoad,async({window:e})=>{const i=e.document;A(s,i)}),t.onReady(()=>{A(s,document),l&&$(d,z,{target:document.body})}),t.setCustomRte({parseContent:!0,async enable(e,i,x){const u=T(e);if(u)return u.rteEditor;const g=await c(e,x);return g&&V(e,g),g==null?void 0:g.rteEditor},disable(e){const i=T(e);i&&(J(e),r(e,i))},getContent(e,i,x){var v;const u=T(e),g=u==null?void 0:u.rteEditor;return g&&!g.isDirty()?x.view.lastContent:g?(v=g.getContent)==null?void 0:v.call(g):e.innerHTML}});const b=K(t,o.enableOnClick);W({editor:t,licenseKey:o.licenseKey,plan:H,pluginName:q,cleanup:()=>{t.RichTextEditor.customRte=void 0,b()}})})});
