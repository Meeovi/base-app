(function(d,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(d=typeof globalThis<"u"?globalThis:d||self,d.StudioSdkPlugins_googleFontsAssetProvider=p())})(this,function(){"use strict";var d=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(d||{}),p=(e=>(e.toastAdd="studio:toastAdd",e.toastRemove="studio:toastRemove",e.dialogOpen="studio:dialogOpen",e.dialogClose="studio:dialogClose",e.dialogExportCode="studio:dialogExportCode",e.sidebarLeftSet="studio:sidebarLeft:set",e.sidebarLeftGet="studio:sidebarLeft:get",e.sidebarLeftToggle="studio:sidebarLeft:toggle",e.sidebarRightSet="studio:sidebarRight:set",e.sidebarRightGet="studio:sidebarRight:get",e.sidebarRightToggle="studio:sidebarRight:toggle",e.sidebarTopSet="studio:sidebarTop:set",e.sidebarTopGet="studio:sidebarTop:get",e.sidebarTopToggle="studio:sidebarTop:toggle",e.sidebarBottomSet="studio:sidebarBottom:set",e.sidebarBottomGet="studio:sidebarBottom:get",e.sidebarBottomToggle="studio:sidebarBottom:toggle",e.symbolAdd="studio:symbolAdd",e.symbolDetach="studio:symbolDetach",e.symbolOverride="studio:symbolOverride",e.symbolPropagateStyles="studio:propagateStyles",e.getPagesConfig="studio:getPagesConfig",e.setPagesConfig="studio:setPagesConfig",e.getPageSettings="studio:getPageSettings",e.setPageSettings="studio:setPageSettings",e.clearPage="studio:clearPage",e.projectFiles="studio:projectFiles",e.validateCode="studio:validateCode",e.canvasReload="studio:canvasReload",e.getBlocksPanel="studio:getBlocksPanel",e.setBlocksPanel="studio:setBlocksPanel",e.getStateContextMenu="studio:getStateContextMenu",e.setStateContextMenu="studio:setStateContextMenu",e.contextMenuComponent="studio:contextMenuComponent",e.layoutAdd="studio:layoutAdd",e.layoutRemove="studio:layoutRemove",e.layoutToggle="studio:layoutToggle",e.layoutUpdate="studio:layoutUpdate",e.layoutGet="studio:layoutGet",e.layoutConfigGet="studio:layoutConfigGet",e.layoutConfigSet="studio:layoutConfigSet",e.getStateTheme="studio:getStateTheme",e.setStateTheme="studio:setStateTheme",e.assetProviderGet="studio:assetProviderGet",e.assetProviderAdd="studio:assetProviderAdd",e.assetProviderRemove="studio:assetProviderRemove",e.fontGet="studio:fontGet",e.fontAdd="studio:fontAdd",e.fontRemove="studio:fontRemove",e.fontManagerOpen="studio:fontManagerOpen",e.menuFontLoad="studio:menuFontLoad",e.toggleStateDataSource="studio:toggleStateDataSource",e.getStateDataSource="studio:getStateDataSource",e.dataSourceSetGlobalData="studio:dataSourceSetGlobalData",e.dataSourceSetImporter="studio:dataSourceSetImporter",e.dataSourceSetExporter="studio:dataSourceSetExporter",e.setDragAbsolute="studio:setDragAbsolute",e))(p||{});const P="app.grapesjs.com",A="app-stage.grapesjs.com",w=[P,"app2.grapesjs.com",A,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],O="license:check:start",G="license:check:end",I=()=>typeof window<"u",k=({isDev:e,isStage:t})=>`${e?"":`https://${t?A:P}`}/api`,$=()=>{const e=I()&&window.location.hostname;return!!e&&(w.includes(e)||w.some(t=>e.endsWith(t)))};async function E({path:e,baseApiUrl:t,method:s="GET",headers:o={},params:n,body:r}){const l=`${t||k({isDev:!1,isStage:!1})}${e}`,c={method:s,headers:{"Content-Type":"application/json",...o}};r&&(c.body=JSON.stringify(r));const u=n?new URLSearchParams(n).toString():"",a=u?`?${u}`:"",g=await fetch(`${l}${a}`,c);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}const L={[d.free]:0,[d.startup]:10,[d.business]:20,[d.enterprise]:30};function M(e){const t=e;return t.init=s=>o=>e(o,s),t}const U=e=>M(e);async function j({editor:e,plan:t,pluginName:s,licenseKey:o,cleanup:n}){let r="",i=!1;const l=$(),c=a=>{console.warn("Cleanup plugin:",s,"Reason:",a),n()},u=(a={})=>{var R;const{error:g,sdkLicense:y}=a,f=(R=a.plan)==null?void 0:R.category;if(!(y||a.license)||g)c(g||"Invalid license");else if(f){const q=L[t],J=L[f];q>J&&c({pluginRequiredPlan:t,licensePlan:f})}};e.on(O,a=>{r=a==null?void 0:a.baseApiUrl,i=!0}),e.on(G,a=>{u(a)}),setTimeout(async()=>{if(!i){if(l)return;if(o){const a=await N({licenseKey:o,pluginName:s,baseApiUrl:r});a&&u(a)}else c("The `licenseKey` option not provided")}},2e3)}async function N(e){const{licenseKey:t,pluginName:s,baseApiUrl:o}=e;try{return(await E({baseApiUrl:o,path:`/sdk/${t||"na"}`,method:"POST",params:{d:window.location.hostname,pn:s}})).result||{}}catch(n){return console.error("Error during SDK license check:",n),!1}}const h=e=>e.replaceAll('"',"").replaceAll("'",""),v=e=>e.includes(",")?e:/\s/.test(e)?`'${h(e)}'`:h(e),T=(e,t,s)=>({family:e,variant:t,...s}),F=(e,t)=>{e=v(e);const{menuVariant:s,variants:o}=t;return{family:e,familyLabel:h(e),menuVariant:s&&T(v(`menuFont-${h(e)}`),"regular",s),variants:Object.assign({},...Object.entries(o).map(([n,r])=>({[n]:T(e,n,r)})))}},x=(e,t)=>{var l;const s=F(e.family,e),o=s.menuVariant??((l=Object.values(s.variants))==null?void 0:l[0]);if(!o)return"Arial, Helvetica, sans-serif";const{source:n,descriptors:r}=o,i=h(o.family);if(!t){const c=new FontFace(i,`url("${n}")`,r),u=Array.from(document.fonts.values()).filter(a=>a.family===i);for(const a of u)document.fonts.delete(a);document.fonts.add(c),c.load().catch(()=>{})}return v(i)},_=e=>{const{family:t,menu:s,axes:o}=e,n=!!o,r=Object.assign({},...e.variants.map(i=>{var a,g;let l,c;if(n){const y=o.find(f=>f.tag==="wght");if(y){const{start:f,end:D}=y;l=`${f} ${D}`}}return l||(l=((a=i.match(/\d+/))==null?void 0:a[0])??"400"),c=((g=i.match(/[a-zA-Z]+/))==null?void 0:g[0])==="italic"?"italic":void 0,{[i]:{source:e.files[i],descriptors:{style:c,weight:l}}}}));return F(t,{menuVariant:{source:s},variants:r})},B=e=>({id:`${e.family}/${e.version}`,type:"font",src:e.menu,name:e.family,customData:{font:_(e),needsLoading:!0}}),W=e=>{const{font:t}=e.customData;return e.customData.needsLoading?(e.customData.needsLoading=!1,x(t)):x(t,!0)};let b;const S=e=>{const t=[];for(const s of Object.keys(e)){let o=e[s];o&&(Array.isArray(o)?t.push(...o.map(n=>[s,n.toString()])):(o=o.toString(),t.push([s,o])))}return new URLSearchParams(t)},K=e=>{const{apiKey:t,searchParams:s}=e,o=(n={})=>{const r="https://www.googleapis.com/webfonts/v1/webfonts",i=S(n);return`${r}?${i}`};return{id:"google-fonts",types:["font"],label:({editor:n})=>n.I18n.t("googleFontsAssetProvider.providerLabel"),search:{reloadOnInput:!1},async onLoad(){var u;if(b)return b;const n={key:t,sort:"alpha",subset:"latin",capability:["WOFF2","VF"]},r=s==null?void 0:s(),i={...n,...r},c=await(await fetch(o(i))).json();return(u=c.items)!=null&&u.length?(b=c.items.map(B),b):[]},itemLayout:n=>{const r=b.find(l=>l.id===n.assetProps.id),i=W(r);return{type:"column",onClick:()=>n.onSelect(r),htmlAttrs:{title:r.name},style:{borderWidth:"1px",borderRadius:8,overflow:"hidden",cursor:"pointer"},children:[{type:"text",content:r.name,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:i,fontSize:"24px",paddingLeft:"8px",paddingRight:"8px"}},{type:"text",content:r.name,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"16px",paddingLeft:"8px",paddingRight:"8px"}}]}}}},V={googleFontsAssetProvider:{searchBtn:"Search on Google Fonts",modalTitle:"Select Font",providerLabel:"Google Fonts"}},H="googleFontsAssetProvider",z=d.startup;return U(function(e,t){const{i18n:s={}}=t,o=K(t);e.runCommand(p.assetProviderAdd,{provider:o}),e.I18n.addMessages({en:V,...s}),j({editor:e,licenseKey:t.licenseKey,plan:z,pluginName:H,cleanup:()=>{e.runCommand(p.assetProviderRemove,{id:o.id})}})})});
