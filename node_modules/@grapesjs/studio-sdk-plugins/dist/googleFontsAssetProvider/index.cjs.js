"use strict";var p=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(p||{}),v=(e=>(e.toastAdd="studio:toastAdd",e.toastRemove="studio:toastRemove",e.dialogOpen="studio:dialogOpen",e.dialogClose="studio:dialogClose",e.dialogExportCode="studio:dialogExportCode",e.sidebarLeftSet="studio:sidebarLeft:set",e.sidebarLeftGet="studio:sidebarLeft:get",e.sidebarLeftToggle="studio:sidebarLeft:toggle",e.sidebarRightSet="studio:sidebarRight:set",e.sidebarRightGet="studio:sidebarRight:get",e.sidebarRightToggle="studio:sidebarRight:toggle",e.sidebarTopSet="studio:sidebarTop:set",e.sidebarTopGet="studio:sidebarTop:get",e.sidebarTopToggle="studio:sidebarTop:toggle",e.sidebarBottomSet="studio:sidebarBottom:set",e.sidebarBottomGet="studio:sidebarBottom:get",e.sidebarBottomToggle="studio:sidebarBottom:toggle",e.symbolAdd="studio:symbolAdd",e.symbolDetach="studio:symbolDetach",e.symbolOverride="studio:symbolOverride",e.symbolPropagateStyles="studio:propagateStyles",e.getPagesConfig="studio:getPagesConfig",e.setPagesConfig="studio:setPagesConfig",e.getPageSettings="studio:getPageSettings",e.setPageSettings="studio:setPageSettings",e.clearPage="studio:clearPage",e.projectFiles="studio:projectFiles",e.validateCode="studio:validateCode",e.canvasReload="studio:canvasReload",e.getBlocksPanel="studio:getBlocksPanel",e.setBlocksPanel="studio:setBlocksPanel",e.getStateContextMenu="studio:getStateContextMenu",e.setStateContextMenu="studio:setStateContextMenu",e.contextMenuComponent="studio:contextMenuComponent",e.layoutAdd="studio:layoutAdd",e.layoutRemove="studio:layoutRemove",e.layoutToggle="studio:layoutToggle",e.layoutUpdate="studio:layoutUpdate",e.layoutGet="studio:layoutGet",e.layoutConfigGet="studio:layoutConfigGet",e.layoutConfigSet="studio:layoutConfigSet",e.getStateTheme="studio:getStateTheme",e.setStateTheme="studio:setStateTheme",e.assetProviderGet="studio:assetProviderGet",e.assetProviderAdd="studio:assetProviderAdd",e.assetProviderRemove="studio:assetProviderRemove",e.fontGet="studio:fontGet",e.fontAdd="studio:fontAdd",e.fontRemove="studio:fontRemove",e.fontManagerOpen="studio:fontManagerOpen",e.menuFontLoad="studio:menuFontLoad",e.toggleStateDataSource="studio:toggleStateDataSource",e.getStateDataSource="studio:getStateDataSource",e.dataSourceSetGlobalData="studio:dataSourceSetGlobalData",e.dataSourceSetImporter="studio:dataSourceSetImporter",e.dataSourceSetExporter="studio:dataSourceSetExporter",e.setDragAbsolute="studio:setDragAbsolute",e))(v||{});const x="app.grapesjs.com",R="app-stage.grapesjs.com",I="app2.grapesjs.com",k="app-stage2.grapesjs.com",w=[x,I,R,k,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],$="license:check:start",E="license:check:end",M=()=>typeof window<"u",U=({isDev:e,isStage:t})=>`${e?"":`https://${t?R:x}`}/api`,j=()=>{const e=M()&&window.location.hostname;return!!e&&(w.includes(e)||w.some(t=>e.endsWith(t)))};async function N({path:e,baseApiUrl:t,method:s="GET",headers:o={},params:n,body:r}){const l=`${t||U({isDev:!1,isStage:!1})}${e}`,c={method:s,headers:{"Content-Type":"application/json",...o}};r&&(c.body=JSON.stringify(r));const u=n?new URLSearchParams(n).toString():"",a=u?`?${u}`:"",g=await fetch(`${l}${a}`,c);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}const L={[p.free]:0,[p.startup]:10,[p.business]:20,[p.enterprise]:30};function B(e){const t=e;return t.init=s=>o=>e(o,s),t}const W=e=>B(e);async function _({editor:e,plan:t,pluginName:s,licenseKey:o,cleanup:n}){let r="",i=!1;const l=j(),c=a=>{console.warn("Cleanup plugin:",s,"Reason:",a),n()},u=(a={})=>{var A;const{error:g,sdkLicense:f}=a,d=(A=a.plan)==null?void 0:A.category;if(!(f||a.license)||g)c(g||"Invalid license");else if(d){const O=L[t],G=L[d];O>G&&c({pluginRequiredPlan:t,licensePlan:d})}};e.on($,a=>{r=a==null?void 0:a.baseApiUrl,i=!0}),e.on(E,a=>{u(a)}),setTimeout(async()=>{if(!i){if(l)return;if(o){const a=await K({licenseKey:o,pluginName:s,baseApiUrl:r});a&&u(a)}else c("The `licenseKey` option not provided")}},2e3)}async function K(e){const{licenseKey:t,pluginName:s,baseApiUrl:o}=e;try{return(await N({baseApiUrl:o,path:`/sdk/${t||"na"}`,method:"POST",params:{d:window.location.hostname,pn:s}})).result||{}}catch(n){return console.error("Error during SDK license check:",n),!1}}const b=e=>e.replaceAll('"',"").replaceAll("'",""),y=e=>e.includes(",")?e:/\s/.test(e)?`'${b(e)}'`:b(e),F=(e,t,s)=>({family:e,variant:t,...s}),D=(e,t)=>{e=y(e);const{menuVariant:s,variants:o}=t;return{family:e,familyLabel:b(e),menuVariant:s&&F(y(`menuFont-${b(e)}`),"regular",s),variants:Object.assign({},...Object.entries(o).map(([n,r])=>({[n]:F(e,n,r)})))}},T=(e,t)=>{var l;const s=D(e.family,e),o=s.menuVariant??((l=Object.values(s.variants))==null?void 0:l[0]);if(!o)return"Arial, Helvetica, sans-serif";const{source:n,descriptors:r}=o,i=b(o.family);if(!t){const c=new FontFace(i,`url("${n}")`,r),u=Array.from(document.fonts.values()).filter(a=>a.family===i);for(const a of u)document.fonts.delete(a);document.fonts.add(c),c.load().catch(()=>{})}return y(i)},V=e=>{const{family:t,menu:s,axes:o}=e,n=!!o,r=Object.assign({},...e.variants.map(i=>{var a,g;let l,c;if(n){const f=o.find(d=>d.tag==="wght");if(f){const{start:d,end:P}=f;l=`${d} ${P}`}}return l||(l=((a=i.match(/\d+/))==null?void 0:a[0])??"400"),c=((g=i.match(/[a-zA-Z]+/))==null?void 0:g[0])==="italic"?"italic":void 0,{[i]:{source:e.files[i],descriptors:{style:c,weight:l}}}}));return D(t,{menuVariant:{source:s},variants:r})},S=e=>({id:`${e.family}/${e.version}`,type:"font",src:e.menu,name:e.family,customData:{font:V(e),needsLoading:!0}}),H=e=>{const{font:t}=e.customData;return e.customData.needsLoading?(e.customData.needsLoading=!1,T(t)):T(t,!0)};let h;const z=e=>{const t=[];for(const s of Object.keys(e)){let o=e[s];o&&(Array.isArray(o)?t.push(...o.map(n=>[s,n.toString()])):(o=o.toString(),t.push([s,o])))}return new URLSearchParams(t)},q=e=>{const{apiKey:t,searchParams:s}=e,o=(n={})=>{const r="https://www.googleapis.com/webfonts/v1/webfonts",i=z(n);return`${r}?${i}`};return{id:"google-fonts",types:["font"],label:({editor:n})=>n.I18n.t("googleFontsAssetProvider.providerLabel"),search:{reloadOnInput:!1},async onLoad(){var u;if(h)return h;const n={key:t,sort:"alpha",subset:"latin",capability:["WOFF2","VF"]},r=s==null?void 0:s(),i={...n,...r},c=await(await fetch(o(i))).json();return(u=c.items)!=null&&u.length?(h=c.items.map(S),h):[]},itemLayout:n=>{const r=h.find(l=>l.id===n.assetProps.id),i=H(r);return{type:"column",onClick:()=>n.onSelect(r),htmlAttrs:{title:r.name},style:{borderWidth:"1px",borderRadius:8,overflow:"hidden",cursor:"pointer"},children:[{type:"text",content:r.name,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:i,fontSize:"24px",paddingLeft:"8px",paddingRight:"8px"}},{type:"text",content:r.name,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"16px",paddingLeft:"8px",paddingRight:"8px"}}]}}}},J={googleFontsAssetProvider:{searchBtn:"Search on Google Fonts",modalTitle:"Select Font",providerLabel:"Google Fonts"}},Q="googleFontsAssetProvider",Z=p.startup,X=function(e,t){const{i18n:s={}}=t,o=q(t);e.runCommand(v.assetProviderAdd,{provider:o}),e.I18n.addMessages({en:J,...s}),_({editor:e,licenseKey:t.licenseKey,plan:Z,pluginName:Q,cleanup:()=>{e.runCommand(v.assetProviderRemove,{id:o.id})}})},Y=W(X);module.exports=Y;
