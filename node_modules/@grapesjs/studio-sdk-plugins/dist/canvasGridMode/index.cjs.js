"use strict";const q="app.grapesjs.com",H="app-stage.grapesjs.com",nt="app2.grapesjs.com",rt="app-stage2.grapesjs.com",W=[q,nt,H,rt,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],st="license:check:start",at="license:check:end",it=()=>typeof window<"u",lt=({isDev:t,isStage:e})=>`${t?"":`https://${e?H:q}`}/api`,ct=()=>{const t=it()&&window.location.hostname;return!!t&&(W.includes(t)||W.some(e=>t.endsWith(e)))};function Y(t){return typeof t=="function"}async function pt({path:t,baseApiUrl:e,method:r="GET",headers:n={},params:o,body:i}){const l=`${e||lt({isDev:!1,isStage:!1})}${t}`,c={method:r,headers:{"Content-Type":"application/json",...n}};i&&(c.body=JSON.stringify(i));const p=o?new URLSearchParams(o).toString():"",a=p?`?${p}`:"",d=await fetch(`${l}${a}`,c);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);return d.json()}var R=(t=>(t.free="free",t.startup="startup",t.business="business",t.enterprise="enterprise",t))(R||{});const j={[R.free]:0,[R.startup]:10,[R.business]:20,[R.enterprise]:30};function dt(t){const e=t;return e.init=r=>n=>t(n,r),e}const ut=t=>dt(t);async function gt({editor:t,plan:e,pluginName:r,licenseKey:n,cleanup:o}){let i="",s=!1;const l=ct(),c=a=>{console.warn("Cleanup plugin:",r,"Reason:",a),o()},p=(a={})=>{var m;const{error:d,sdkLicense:u}=a,g=(m=a.plan)==null?void 0:m.category;if(!(u||a.license)||d)c(d||"Invalid license");else if(g){const w=j[e],b=j[g];w>b&&c({pluginRequiredPlan:e,licensePlan:g})}};t.on(st,a=>{i=a==null?void 0:a.baseApiUrl,s=!0}),t.on(at,a=>{p(a)}),setTimeout(async()=>{if(!s){if(l)return;if(n){const a=await mt({licenseKey:n,pluginName:r,baseApiUrl:i});a&&p(a)}else c("The `licenseKey` option not provided")}},2e3)}async function mt(t){const{licenseKey:e,pluginName:r,baseApiUrl:n}=t;try{return(await pt({baseApiUrl:n,path:`/sdk/${e||"na"}`,method:"POST",params:{d:window.location.hostname,pn:r}})).result||{}}catch(o){return console.error("Error during SDK license check:",o),!1}}const N="canvasGridMode",ft=R.startup,L="component-grid-mode",A="grid-mode",D="gjs-drag-grid-spot",K=`${D}__grid-item`,X=`${D}__grid-target`,J=`${D}__snapped`,yt=`${D}__container`,ht=()=>{const t="data-gjs-drag-grid-style",e=document,r="var(--gs-theme-cl-cmp-bg1, var(--gjs-color-highlight))",n="var(--gs-theme-cl-cmp-bg2, var(--gjs-color-blue))",o=e.querySelector(`style[${t}]`)||e.createElement("style");o.setAttribute(t,"true"),o.innerHTML=`
        .${K} {
            outline: 2px solid ${n};
            background: ${r};
            outline-offset: -2px;
            border-radius: 3px;
            width: 100%;
            height: 100%;
            opacity: 0.1;
        }
        .${J} {
            width: 100%;
            height: 100%;
            outline: 2px solid ${n};
            outline-offset: -2px;
            position: absolute;
        }
        .${X} {
            position: absolute;
            z-index: -1;
            background: ${r};
            outline: 1px solid ${n};
            outline-offset: -1px;
            opacity: 0.35;
        }
    `,e.head.appendChild(o)};function Q(t){const{editor:e,type:r}=t,n=$t(e,t.component),o=z(e,n.component);if(!vt(e,n,o,r))return{target:n,container:o,startScroll:et(e).scroll,shadowContainerEl:document.createElement("div"),shadowSnappedEl:document.createElement("div"),shadowTargetEl:document.createElement("div"),spot:e.Canvas.addSpot({type:A,component:o.component})}}function Z(t){const{editor:e,shadowTargetEl:r,shadowSnappedEl:n,shadowContainerEl:o,spotEl:i,target:s,container:l}=t,{Canvas:c}=e,p=e.config.stylePrefix;i==null||i.appendChild(o),o==null||o.appendChild(r),o==null||o.appendChild(n),wt(o,l),St(r,s,l),bt(n,s),Ct(o,l.el),s.el.style.opacity="0";const a=c.getSpots().filter(d=>d.type!==A);e.em.stopDefault({preserveSelected:!0}),c.removeSpots(a),c.startAutoscroll(),c.getBody().classList.add(`${p}is__grabbing`)}function V(t){const{editor:e,shadowSnappedEl:r,shadowContainerEl:n,target:o,cancelled:i}=t,{Canvas:s}=e,l=e.config.stylePrefix,{component:c}=o;if(!i){const p=window.getComputedStyle(r);c.addStyle({"grid-area":p.gridArea,width:"",height:""})}o.el.style.opacity="",n.contains(r)&&(n==null||n.removeChild(r)),e.getModel().runDefault({preserveSelected:1}),s.stopAutoscroll(),s.getBody().classList.remove(`${l}is__grabbing`),s.removeSpots({type:A}),e.select(c)}function wt(t,{rows:e,columns:r}){const n=[];for(let o=0;o<r.length;o++){n[o]=[];for(let i=0;i<e.length;i++){const s=document.createElement("div");s.className=K,s.style.gridArea=`${i+1} / ${o+1}`,n[o][i]=s,t.appendChild(s)}}return n}function St(t,e,r){return t.className=X,t.style.top=`${e.offset.top-r.offset.top}px`,t.style.left=`${e.offset.left-r.offset.left}px`,t.style.width=`${e.offset.width+e.margin.left+e.margin.right}px`,t.style.height=`${e.offset.height+e.margin.top+e.margin.bottom}px`,t}function bt(t,e){const r=ot(e.el,e.computedStyles);return t.className=J,t.style.gridArea=`${r.row.start} / ${r.column.start} / ${r.row.end} / ${r.column.end}`,t}function Ct(t,e){const r=window.getComputedStyle(e);t.className=yt,t.style.position="relative",t.style.display=r.display,t.style.gap=r.gap,t.style.padding=r.padding,t.style.border=r.border,t.style.gridTemplateColumns=r.gridTemplateColumns,t.style.gridTemplateRows=r.gridTemplateRows}function tt(t,e){if(e){if(Array.isArray(e))return[...e].pop()}else return[...t.getSelectedAll()].pop();return e}function $t(t,e){const r=tt(t,e),n=r.getEl(),o=window.getComputedStyle(n);return{component:r,el:n,offset:t.Canvas.offset(n),margin:{top:parseFloat(o.marginTop),right:parseFloat(o.marginRight),bottom:parseFloat(o.marginBottom),left:parseFloat(o.marginLeft)},computedStyles:o}}function z(t,e){const r=e.parent(),n=r.getEl(),o=window.getComputedStyle(n);return{component:r,el:n,offset:t.Canvas.offset(n),computedStyles:o,padding:{top:parseFloat(o.paddingTop),right:parseFloat(o.paddingRight),bottom:parseFloat(o.paddingBottom),left:parseFloat(o.paddingLeft)},columns:o.gridTemplateColumns.split(" ").map(s=>parseFloat(s)),rows:o.gridTemplateRows.split(" ").map(s=>parseFloat(s)),gap:{column:parseInt(o.columnGap),row:parseInt(o.rowGap)}}}function E(t,e,r,n,o=1){let i=0;for(let s=e;s<=t.length;s++){if(i+(t[s-1]+n)*o>r)return s;i+=n+t[s-1]}return t.length+1}function et(t){const{scrollY:e,scrollX:r}=t.Canvas.getWindow();return{scroll:{top:e,left:r}}}function vt(t,e,r,n){const o=i=>t.em.logWarning(i);return n==="draggable"&&e.component.get(n)===!1?(o(`[${N}] The element is not ${n}`),!0):r.computedStyles.display!=="grid"?(o(`[${N}] The container does not have style display:grid`),!0):!1}function _(t,e,r={}){const n=tt(t,e),o=n==null?void 0:n.parent(),i=o==null?void 0:o.getEl();if(!o||!i)return!1;const{enableGrid:s}=r,l=window.getComputedStyle(i).display==="grid";return Y(s)?s({component:n,parent:o,isParentGrid:l}):l}const B=t=>t.split(" ").map(e=>parseFloat(e));function ot(t,e){const r=t.ownerDocument.defaultView,n=e||r.getComputedStyle(t),o=n.gridArea.split("/").some(S=>isNaN(parseInt(S.trim()))),i={isComputed:o,raw:n.gridArea};if(!o)return{...i,row:{start:parseInt(n.gridRowStart),end:parseInt(n.gridRowEnd)},column:{start:parseInt(n.gridColumnStart),end:parseInt(n.gridColumnEnd)}};const s=t.parentElement,l=r.getComputedStyle(s),c=parseFloat(l.columnGap)||0,p=parseFloat(l.rowGap)||0,a=B(l.gridTemplateColumns),d=B(l.gridTemplateRows),u=parseFloat(l.paddingLeft)||0,g=parseFloat(l.paddingTop)||0,h=s.getBoundingClientRect(),m=t.getBoundingClientRect(),w=(S,C,x,$,M)=>{let G=1,T=$+M;for(let P=0;P<C.length;P++){const I=C[P],O=T+I;if(S>=T&&S<O)return G;T=O+x,G++}return-1},b=w(m.left,a,c,h.left,u),v=w(m.right-1,a,c,h.left,u)+1,y=w(m.top,d,p,h.top,g),f=w(m.bottom-1,d,p,h.top,g)+1;return{...i,row:{start:y,end:f},column:{start:b,end:v}}}function Et(t){t.Commands.add(L,{stop(){},run(e,r,n={}){const o=Q({editor:e,component:n.target,type:"draggable"});if(!o){this.stopCommand();return}const{spot:i,target:s,shadowContainerEl:l,shadowSnappedEl:c,shadowTargetEl:p,startScroll:a}=o;let{container:d}=o,u;new e.Utils.Dragger({doc:s.el.ownerDocument,onStart:()=>{u=setTimeout(()=>{Z({editor:e,shadowTargetEl:p,shadowSnappedEl:c,shadowContainerEl:l,spotEl:i.attributes.spotEl,target:s,container:d}),d=z(e,s.component)},10)},onEnd:(h,m,{cancelled:w})=>{clearTimeout(u),V({editor:e,shadowSnappedEl:c,shadowContainerEl:l,target:s,cancelled:w}),this.stopCommand(),e.em.set("_cmpDrag",1)},setPosition:({x:h,y:m})=>{const{scroll:w}=et(e),{columns:b,rows:v,gap:y,offset:f,padding:S}=d,{offset:C,margin:x}=s,$=C.top-f.top-S.top-x.top+m-a.top+w.top,M=C.left-f.left-S.left-x.left+h-a.left+w.left,G=Math.min(E(b,1,M,y.column,.5),b.length),T=Math.min(E(v,1,$,y.row,.5),v.length),P=Math.min(E(b,G,C.width,y.column)+1,b.length+1),I=Math.min(E(v,T,C.height,y.row)+1,v.length+1);c.style.gridArea=`${T} / ${G} / ${I} / ${P}`,p.style.top=`${$+S.top}px`,p.style.left=`${M+S.left}px`}}).start(n.event)}})}function xt(t,e){const r=Q({editor:t,component:e.component,type:"resizable"});if(!r)return;const{onMove:n,onEnd:o}=e.options||{},{spot:i,target:s,shadowContainerEl:l,shadowSnappedEl:c,shadowTargetEl:p}=r;let{container:a}=r,d="",u;return{onStart:g=>{d=g.target.dataset.gjsHandler||"",u=setTimeout(()=>{Z({editor:t,shadowTargetEl:p,shadowSnappedEl:c,shadowContainerEl:l,spotEl:i.attributes.spotEl,target:s,container:a}),a=z(t,s.component)},10),t.trigger("component:resize",{...s,type:"start"})},onEnd:(g,h)=>{const{startDim:m,rectDim:w}=h.resizer,b=JSON.stringify(m)===JSON.stringify(w);clearTimeout(u),V({editor:t,shadowSnappedEl:c,shadowContainerEl:l,target:s,cancelled:b}),o==null||o(g,h)},onMove:(g,h)=>{const m=ot(c),w=s.margin.left,b=s.margin.top,v=s.margin.bottom,y=s.margin.right,{w:f,t:S,l:C,h:x}=h.resizer.rectDim,$={t:S-b,l:C-w,h:x+b+v,w:f+w+y};d.endsWith("l")&&(m.column.start=E(a.columns,1,$.l-a.offset.left-a.padding.left,a.gap.column,.5)),d.startsWith("t")&&(m.row.start=E(a.rows,1,$.t-a.offset.top-a.padding.top,a.gap.row,.5)),d.endsWith("r")&&(m.column.end=Math.max(E(a.columns,m.column.start,$.w,a.gap.column,.5),m.column.start+1)),d.startsWith("b")&&(m.row.end=Math.max(E(a.rows,m.row.start,$.h,a.gap.row,.5),m.row.start+1)),c.style.gridArea=`${m.row.start} / ${m.column.start} / ${m.row.end} / ${m.column.end}`,p.style.width=`${$.w}px`,p.style.height=`${$.h}px`,p.style.left=`${$.l-a.offset.left}px`,p.style.top=`${$.t-a.offset.top}px`,n==null||n(g,h)}}}const k=["px","%","em","rem","vw","vh"],Tt=(t,e)=>{const r=t.Styles.getSectors().find(n=>!!n.getProperty(e));return{sector:r,property:r?r.getProperty(e):void 0}},Rt=(t,e)=>Tt(t,e),Gt=(t,{x:e,y:r,mergable:n}={})=>{const o={property:`${t}-x`,type:"integer",units:k,...e},i={property:`${t}-y`,type:"integer",units:k,...r};return{property:t,type:"composite",properties:[o,i],...n&&{fromStyle(s,{name:l,separator:c,property:p}){const[a,d]=p.getProperties(),[u,g]=(s[l]||"").split(c);return{[a.getId()]:s[a.getName()]||u||"",[d.getId()]:s[d.getName()]||g||u||""}},toStyle(s,{name:l,property:c}){const[p,a]=c.getProperties(),d=s[p.getId()],u=s[a.getId()];return{[l]:d===u?d:`${d} ${u}`}}}}},F={display:["grid"]};function Pt(t=""){const e=/^repeat\(\s*(\d+)\s*,\s*(.+)\s*\)$/i,r=/^minmax\(\s*(.+?)\s*,\s*(.+?)\s*\)$/i,n=t.match(e);if(!n)return null;const o=parseInt(n[1],10),i=n[2];let s=i,l=i;const c=i.match(r);return c&&(s=c[1],l=c[2]),{total:o,min:s===l?"":s,max:l}}function At(t={}){let e="",r="",n="",o="";const i=m=>m.split("/").map(w=>w.trim()).filter(Boolean),s=t["grid-area"]||"",l=t["grid-column"]||"",c=t["grid-row"]||"",p=i(s),a=i(l),d=i(c),u=p.length,g=a.length,h=d.length;return u===4?(n=p[0],e=p[1],o=p[2],r=p[3]):u===3?(n=p[0],e=p[1],o=p[2]):u===2?(n=p[0],e=p[1]):u===1&&(n=p[0]),g===2?(e=a[0],r=a[1]):g===1&&(e=a[0]),h===2?(n=d[0],o=d[1]):h===1&&(n=d[0]),{columnStart:e,columnEnd:r,rowStart:n,rowEnd:o}}function U(t){const{property:e,label:r}=t,n="1",o="1fr";return{property:e,label:r,type:"composite",requires:F,generic:!0,properties:[{name:" ",property:`${e}-repeat`,type:"number",full:!0,min:1,default:"1"},{label:"Min size",property:`${e}-min`,type:"number",min:0,units:["px","%"],default:"0"},{label:"Max size",property:`${e}-max`,type:"number",min:1,units:["fr","px","%"],default:"1"}],fromStyle(i,s){const{name:l,property:c}=s,[p,a,d]=c.getProperties(),u=i[l],g=Pt(u),h=(g==null?void 0:g.max)??o;return{[p.id]:(g==null?void 0:g.total)??n,[a.id]:(g==null?void 0:g.min)??"",[d.id]:h===o?"":h}},toStyle(i,{name:s,property:l}){const[c,p,a]=l.getProperties(),d=i[c.id],u=i[p.id],g=i[a.id]||o,h=u&&g?`minmax(${u}, ${g})`:g;return{[s]:`repeat(${d||n}, ${h})`}}}}function Dt(t,e){if(!e.styleableGrid)return;const{property:r,...n}=Rt(t,"display");if(!r)return;const o=r.getOption("grid"),i=n.sector;o||r.addOption({id:"grid",label:"Grid"}),i.addProperty(U({label:"Columns",property:"grid-template-columns"}),{}),i.addProperty(U({label:"Rows",property:"grid-template-rows"}),{}),i.addProperty({id:"grid-gap",requires:F,...Gt("gap",{x:{id:"grid-row-gap",label:"Row",property:"row-gap",min:0,default:"0"},y:{id:"grid-column-gap",label:"Column",property:"column-gap",min:0,default:"0"},mergable:!0})},{}),i.addProperty({type:"composite",property:"grid-area",label:"Grid area",requiresParent:F,generic:!0,properties:[{label:"Row start",property:"grid-row-start",type:"integer",default:"auto"},{label:"Row end",property:"grid-row-end",type:"integer",default:"auto"},{label:"Column start",property:"grid-column-start",type:"integer",default:"auto"},{label:"Column end",property:"grid-column-end",type:"integer",default:"auto"}],fromStyle(s){const l=At(s);return{"grid-column-start":s["grid-column-start"]||l.columnStart,"grid-column-end":s["grid-column-end"]||l.columnEnd,"grid-row-start":s["grid-row-start"]||l.rowStart,"grid-row-end":s["grid-row-end"]||l.rowEnd}},toStyle(s,{name:l}){const c=s["grid-row-start"]||"auto",p=s["grid-row-end"]||"auto",a=s["grid-column-start"]||"auto",d=s["grid-column-end"]||"auto";return{[l]:`${c} / ${a} / ${p} / ${d}`}}},{})}const Mt=function(t,e={}){const r={itemResizable:!0,...e},{Canvas:n,Commands:o,Components:i}=t,{itemResizable:s}=r,l=n.events,c=o.events,p=i.events,a=`${c.runBeforeCommand}tlb-move`,d=`${c.runBeforeCommand}resize`;let u;Et(t);const g=({options:y})=>{_(t,y.target,r)&&(t.runCommand(L,{...y}),y.abort=!0)},h=y=>{const{options:f}=y;_(t,f.component,r)&&(f.options=Object.assign(f.options||{},xt(t,f)))},m=()=>{const y=n.getSpots({type:A}).pop();if(!y)return;let f=y.attributes.spotEl;f||(f=document.createElement("div"),f.className=D,y.set({spotEl:f})),Object.entries(y.getStyle()).forEach(([S,C])=>f.style.setProperty(S,C)),u==null||u.appendChild(f)},w=({spot:y})=>{const f=y.attributes.spotEl;y.type!==A||!f||u==null||u.removeChild(f)};if(s){const y=f=>{const S=Y(s)?s({component:f}):s;return typeof S=="boolean"?S:{tl:!1,tc:!1,tr:!1,cl:!1,cr:!1,bl:!1,bc:!1,br:!1,...S}};t.on(p.resizeInit,f=>{const{component:S}=f;if(_(t,S,r)){const C=y(S);f.resizable=C}})}const b=[[a,g],[d,h],[l.spot,m],[l.spotRemove,w]];b.forEach(([y,f])=>{t.on(y,f)}),t.onReady(()=>{u=n.getSpotsEl(),ht(),Dt(t,r)});const v=()=>{delete t.Commands.commands[L],b.forEach(([y,f])=>{t.off(y,f)})};gt({editor:t,licenseKey:r.licenseKey,plan:ft,pluginName:N,cleanup:v})},It=ut(Mt);module.exports=It;
