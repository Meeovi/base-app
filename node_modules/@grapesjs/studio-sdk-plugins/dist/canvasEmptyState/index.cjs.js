"use strict";const U="app.grapesjs.com",M="app-stage.grapesjs.com",W="app2.grapesjs.com",D="app-stage2.grapesjs.com",I=[U,W,M,D,"localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],P="license:check:start",_="license:check:end",$=()=>typeof window<"u",O=({isDev:e,isStage:t})=>`${e?"":`https://${t?M:U}`}/api`,R=()=>{const e=$()&&window.location.hostname;return!!e&&(I.includes(e)||I.some(t=>e.endsWith(t)))};function j(e){return typeof e=="function"}async function K({path:e,baseApiUrl:t,method:a="GET",headers:o={},params:c,body:u}){const g=`${t||O({isDev:!1,isStage:!1})}${e}`,f={method:a,headers:{"Content-Type":"application/json",...o}};u&&(f.body=JSON.stringify(u));const d=c?new URLSearchParams(c).toString():"",n=d?`?${d}`:"",i=await fetch(`${g}${n}`,f);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return i.json()}var w=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(w||{});const N={[w.free]:0,[w.startup]:10,[w.business]:20,[w.enterprise]:30};function G(e){const t=e;return t.init=a=>o=>e(o,a),t}const x=e=>G(e);async function F({editor:e,plan:t,pluginName:a,licenseKey:o,cleanup:c}){let u="",h=!1;const g=R(),f=n=>{console.warn("Cleanup plugin:",a,"Reason:",n),c()},d=(n={})=>{var C;const{error:i,sdkLicense:E}=n,y=(C=n.plan)==null?void 0:C.category;if(!(E||n.license)||i)f(i||"Invalid license");else if(y){const L=N[t],T=N[y];L>T&&f({pluginRequiredPlan:t,licensePlan:y})}};e.on(P,n=>{u=n==null?void 0:n.baseApiUrl,h=!0}),e.on(_,n=>{d(n)}),setTimeout(async()=>{if(!h){if(g)return;if(o){const n=await H({licenseKey:o,pluginName:a,baseApiUrl:u});n&&d(n)}else f("The `licenseKey` option not provided")}},2e3)}async function H(e){const{licenseKey:t,pluginName:a,baseApiUrl:o}=e;try{return(await K({baseApiUrl:o,path:`/sdk/${t||"na"}`,method:"POST",params:{d:window.location.hostname,pn:a}})).result||{}}catch(c){return console.error("Error during SDK license check:",c),!1}}const q="canvasEmptyState",B=w.startup,J=function(e,t={}){const a=new WeakMap,o=new WeakMap,c=new WeakMap,u=new Set,h=new WeakMap,g={emptyStates:[],...t},f=(s,r)=>{let m=!1;const{isValid:p}=r;return Array.isArray(p)?m=p.some(l=>s.is(l)):j(p)?m=p({component:s,editor:e}):m=s.is(p),m},d=s=>{const r=a.get(s);a.delete(s),r==null||r()},n=s=>{s.views.forEach(r=>d(r)),c.delete(s)},i=s=>{if(!(!s||u.has(s)))try{u.add(s);const r=s.components().length>0,m=c.get(s);if(r&&m)n(s);else if(!r&&!m){const p=h.has(s)?h.get(s):g.emptyStates.find(l=>f(s,l));if(h.set(s,p),!p)return;s.views.forEach(l=>{const b=p.render({editor:e,component:s,componentView:l,mount:v=>{o.set(l,v),c.set(s,!0);const A=l.getChildrenContainer();A==null||A.appendChild(v)},unmount:()=>d(l)});a.set(l,()=>{b==null||b();const v=o.get(l);v==null||v.remove()})})}}finally{u.delete(s)}},E=s=>{c.has(s)&&n(s)},y=({model:s})=>{i(s.getComponent())},S=e.Components.events,C=`${S.update}:components`,L="component:mount",T=e.Canvas.events.frameLoadBody,k=S.removed;e.on(C,i),e.on(L,i),e.on(k,E),e.on(T,y),F({editor:e,licenseKey:g.licenseKey,plan:B,pluginName:q,cleanup:()=>{e.off(C,i),e.off(L,i),e.off(k,E),e.off(T,y)}})},z=x(J);module.exports=z;
