(function(y,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(y=typeof globalThis<"u"?globalThis:y||self,y.StudioSdkPlugins_canvasEmptyState=g())})(this,function(){"use strict";const y="app.grapesjs.com",g="app-stage.grapesjs.com",k=[y,"app2.grapesjs.com",g,"app-stage2.grapesjs.com","localhost","127.0.0.1",".local-credentialless.webcontainer.io",".local.webcontainer.io","-sandpack.codesandbox.io"],P="license:check:start",U="license:check:end",_=()=>typeof window<"u",W=({isDev:e,isStage:t})=>`${e?"":`https://${t?g:y}`}/api`,O=()=>{const e=_()&&window.location.hostname;return!!e&&(k.includes(e)||k.some(t=>e.endsWith(t)))};function $(e){return typeof e=="function"}async function R({path:e,baseApiUrl:t,method:o="GET",headers:a={},params:i,body:u}){const w=`${t||W({isDev:!1,isStage:!1})}${e}`,f={method:o,headers:{"Content-Type":"application/json",...a}};u&&(f.body=JSON.stringify(u));const d=i?new URLSearchParams(i).toString():"",s=d?`?${d}`:"",c=await fetch(`${w}${s}`,f);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return c.json()}var v=(e=>(e.free="free",e.startup="startup",e.business="business",e.enterprise="enterprise",e))(v||{});const D={[v.free]:0,[v.startup]:10,[v.business]:20,[v.enterprise]:30};function j(e){const t=e;return t.init=o=>a=>e(a,o),t}const G=e=>j(e);async function K({editor:e,plan:t,pluginName:o,licenseKey:a,cleanup:i}){let u="",h=!1;const w=O(),f=s=>{console.warn("Cleanup plugin:",o,"Reason:",s),i()},d=(s={})=>{var S;const{error:c,sdkLicense:T}=s,C=(S=s.plan)==null?void 0:S.category;if(!(T||s.license)||c)f(c||"Invalid license");else if(C){const A=D[t],L=D[C];A>L&&f({pluginRequiredPlan:t,licensePlan:C})}};e.on(P,s=>{u=s==null?void 0:s.baseApiUrl,h=!0}),e.on(U,s=>{d(s)}),setTimeout(async()=>{if(!h){if(w)return;if(a){const s=await x({licenseKey:a,pluginName:o,baseApiUrl:u});s&&d(s)}else f("The `licenseKey` option not provided")}},2e3)}async function x(e){const{licenseKey:t,pluginName:o,baseApiUrl:a}=e;try{return(await R({baseApiUrl:a,path:`/sdk/${t||"na"}`,method:"POST",params:{d:window.location.hostname,pn:o}})).result||{}}catch(i){return console.error("Error during SDK license check:",i),!1}}const F="canvasEmptyState",H=v.startup;return G(function(e,t={}){const o=new WeakMap,a=new WeakMap,i=new WeakMap,u=new Set,h=new WeakMap,w={emptyStates:[],...t},f=(n,r)=>{let m=!1;const{isValid:p}=r;return Array.isArray(p)?m=p.some(l=>n.is(l)):$(p)?m=p({component:n,editor:e}):m=n.is(p),m},d=n=>{const r=o.get(n);o.delete(n),r==null||r()},s=n=>{n.views.forEach(r=>d(r)),i.delete(n)},c=n=>{if(!(!n||u.has(n)))try{u.add(n);const r=n.components().length>0,m=i.get(n);if(r&&m)s(n);else if(!r&&!m){const p=h.has(n)?h.get(n):w.emptyStates.find(l=>f(n,l));if(h.set(n,p),!p)return;n.views.forEach(l=>{const I=p.render({editor:e,component:n,componentView:l,mount:E=>{a.set(l,E),i.set(n,!0);const N=l.getChildrenContainer();N==null||N.appendChild(E)},unmount:()=>d(l)});o.set(l,()=>{I==null||I();const E=a.get(l);E==null||E.remove()})})}}finally{u.delete(n)}},T=n=>{i.has(n)&&s(n)},C=({model:n})=>{c(n.getComponent())},b=e.Components.events,S=`${b.update}:components`,A="component:mount",L=e.Canvas.events.frameLoadBody,M=b.removed;e.on(S,c),e.on(A,c),e.on(M,T),e.on(L,C),K({editor:e,licenseKey:w.licenseKey,plan:H,pluginName:F,cleanup:()=>{e.off(S,c),e.off(A,c),e.off(M,T),e.off(L,C)}})})});
