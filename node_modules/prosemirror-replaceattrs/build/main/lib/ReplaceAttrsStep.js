"use strict";
// Copyright (C) 2020, Orkhan Alikhanov <http://orkhanalikhanov.com>. All rights reserved.
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReplaceAttrsStep = void 0;
const prosemirror_model_1 = require("prosemirror-model");
const prosemirror_transform_1 = require("prosemirror-transform");
class ReplaceAttrsStep extends prosemirror_transform_1.Step {
    /**
     * @param at The position of node whose attrs should be updated.
     * @param attrs New attribues to set.
     */
    constructor(at, attrs) {
        super();
        this.at = at;
        this.attrs = attrs;
    }
    /**
     * {@inheritDoc}
     */
    static fromJSON(_schema, json) {
        return new ReplaceAttrsStep(json.at, json.attrs);
    }
    /**
     * {@inheritDoc}
     */
    apply(doc) {
        const node = doc.nodeAt(this.at);
        if (!node) {
            return prosemirror_transform_1.StepResult.fail('Node could not be found');
        }
        const newNode = node.copy();
        newNode.attrs = this.attrs;
        return prosemirror_transform_1.StepResult.ok(doc.replace(this.at, this.at + 1, new prosemirror_model_1.Slice(prosemirror_model_1.Fragment.from(newNode), 0, 0)));
    }
    /**
     * {@inheritDoc}
     */
    invert(doc) {
        return new ReplaceAttrsStep(this.at, doc.nodeAt(this.at).attrs);
    }
    /**
     * {@inheritDoc}
     */
    map(mapping) {
        const at = mapping.mapResult(this.at);
        return at.deleted ? null : new ReplaceAttrsStep(this.at, this.attrs);
    }
    /**
     * {@inheritDoc}
     */
    merge(other) {
        if (other instanceof ReplaceAttrsStep && other.at === this.at) {
            return new ReplaceAttrsStep(this.at, this.attrs);
        }
        return null;
    }
    /**
     * {@inheritDoc}
     */
    toJSON() {
        return {
            attrs: this.attrs,
            at: this.at,
            stepType: 'replaceAttrs'
        };
    }
}
exports.ReplaceAttrsStep = ReplaceAttrsStep;
prosemirror_transform_1.Step.jsonID('replaceAttrs', ReplaceAttrsStep);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwbGFjZUF0dHJzU3RlcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvUmVwbGFjZUF0dHJzU3RlcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMEZBQTBGOzs7QUFFMUYseURBQWtFO0FBQ2xFLGlFQUF5RDtBQUV6RCxNQUFhLGdCQUFtQyxTQUFRLDRCQUFPO0lBUTdEOzs7T0FHRztJQUNILFlBQW1CLEVBQVUsRUFBUyxLQUFVO1FBQzlDLEtBQUssRUFBRSxDQUFDO1FBRFMsT0FBRSxHQUFGLEVBQUUsQ0FBUTtRQUFTLFVBQUssR0FBTCxLQUFLLENBQUs7SUFFaEQsQ0FBQztJQWJEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFlLEVBQUUsSUFBUztRQUMvQyxPQUFPLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQVVEOztPQUVHO0lBQ0ksS0FBSyxDQUFDLEdBQVM7UUFDcEIsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNULE9BQU8sa0NBQVUsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztTQUNuRDtRQUVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM1QixPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFM0IsT0FBTyxrQ0FBVSxDQUFDLEVBQUUsQ0FDbEIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUkseUJBQUssQ0FBQyw0QkFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FDM0UsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxHQUFTO1FBQ3JCLE9BQU8sSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRDs7T0FFRztJQUNJLEdBQUcsQ0FBQyxPQUFZO1FBQ3JCLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxLQUFXO1FBQ3RCLElBQUksS0FBSyxZQUFZLGdCQUFnQixJQUFJLEtBQUssQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3RCxPQUFPLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDbEQ7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU07UUFDWCxPQUFPO1lBQ0wsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNYLFFBQVEsRUFBRSxjQUFjO1NBQ3pCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFyRUQsNENBcUVDO0FBRUQsNEJBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLENBQUMifQ==