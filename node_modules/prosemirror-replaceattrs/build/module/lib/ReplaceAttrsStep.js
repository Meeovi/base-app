// Copyright (C) 2020, Orkhan Alikhanov <http://orkhanalikhanov.com>. All rights reserved.
import { Fragment, Slice } from 'prosemirror-model';
import { Step, StepResult } from 'prosemirror-transform';
export class ReplaceAttrsStep extends Step {
    /**
     * @param at The position of node whose attrs should be updated.
     * @param attrs New attribues to set.
     */
    constructor(at, attrs) {
        super();
        this.at = at;
        this.attrs = attrs;
    }
    /**
     * {@inheritDoc}
     */
    static fromJSON(_schema, json) {
        return new ReplaceAttrsStep(json.at, json.attrs);
    }
    /**
     * {@inheritDoc}
     */
    apply(doc) {
        const node = doc.nodeAt(this.at);
        if (!node) {
            return StepResult.fail('Node could not be found');
        }
        const newNode = node.copy();
        newNode.attrs = this.attrs;
        return StepResult.ok(doc.replace(this.at, this.at + 1, new Slice(Fragment.from(newNode), 0, 0)));
    }
    /**
     * {@inheritDoc}
     */
    invert(doc) {
        return new ReplaceAttrsStep(this.at, doc.nodeAt(this.at).attrs);
    }
    /**
     * {@inheritDoc}
     */
    map(mapping) {
        const at = mapping.mapResult(this.at);
        return at.deleted ? null : new ReplaceAttrsStep(this.at, this.attrs);
    }
    /**
     * {@inheritDoc}
     */
    merge(other) {
        if (other instanceof ReplaceAttrsStep && other.at === this.at) {
            return new ReplaceAttrsStep(this.at, this.attrs);
        }
        return null;
    }
    /**
     * {@inheritDoc}
     */
    toJSON() {
        return {
            attrs: this.attrs,
            at: this.at,
            stepType: 'replaceAttrs'
        };
    }
}
Step.jsonID('replaceAttrs', ReplaceAttrsStep);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwbGFjZUF0dHJzU3RlcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvUmVwbGFjZUF0dHJzU3RlcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwwRkFBMEY7QUFFMUYsT0FBTyxFQUFFLFFBQVEsRUFBZ0IsS0FBSyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEUsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV6RCxNQUFNLE9BQU8sZ0JBQW1DLFNBQVEsSUFBTztJQVE3RDs7O09BR0c7SUFDSCxZQUFtQixFQUFVLEVBQVMsS0FBVTtRQUM5QyxLQUFLLEVBQUUsQ0FBQztRQURTLE9BQUUsR0FBRixFQUFFLENBQVE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFLO0lBRWhELENBQUM7SUFiRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBZSxFQUFFLElBQVM7UUFDL0MsT0FBTyxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFVRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxHQUFTO1FBQ3BCLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztTQUNuRDtRQUVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM1QixPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFM0IsT0FBTyxVQUFVLENBQUMsRUFBRSxDQUNsQixHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FDM0UsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxHQUFTO1FBQ3JCLE9BQU8sSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRDs7T0FFRztJQUNJLEdBQUcsQ0FBQyxPQUFZO1FBQ3JCLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxLQUFXO1FBQ3RCLElBQUksS0FBSyxZQUFZLGdCQUFnQixJQUFJLEtBQUssQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3RCxPQUFPLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDbEQ7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU07UUFDWCxPQUFPO1lBQ0wsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNYLFFBQVEsRUFBRSxjQUFjO1NBQ3pCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDIn0=