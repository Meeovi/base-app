"use client";import{useCallback as _,useState as w}from"react";import{EventSourcePlus as L}from"event-source-plus";import E from"eventemitter3";var C=t=>{let e=new E,r=new L(t,{credentials:"include"}),s={onMessage:async i=>{let n=JSON.parse(i.data);e.emit(n.key,n.payload)}};return[e,()=>r.listen(s)]};var g=(t,e,r=15e3)=>{let[s,c]=w(null);return[_(async()=>await new Promise((n,y)=>{let S=`${t._baseURL}v1/checkouts/client/${e.clientSecret}/stream`,[o,P]=C(S),p=P(),l=!1,d=!1,u=e.productPrice.type!=="recurring",f=!1,a=()=>{l&&d&&u&&c(`Waiting confirmation from ${e.organization.name} `),l&&d&&u&&f&&(p.abort(),n())},k=m=>{m.status==="succeeded"&&(l=!0,c("Payment successful! Processing order..."),o.off("checkout.updated",k),a())};o.on("checkout.updated",k);let h=()=>{d=!0,o.off("checkout.order_created",h),a()};o.on("checkout.order_created",h);let b=()=>{u=!0,o.off("checkout.subscription_created",b),a()};u||o.on("checkout.subscription_created",b);let v=m=>{m.status==="succeeded"&&(f=!0,o.off("checkout.webhook_event_delivered",v),a())};o.on("checkout.webhook_event_delivered",v),setTimeout(()=>{p.abort(),y()},r)}),[t,e,r]),s]};import{loadStripe as x}from"@stripe/stripe-js";import{useCallback as A,useMemo as H,useState as M}from"react";var N=t=>{let[e,r]=M(!1),s=H(()=>t.paymentProcessorMetadata?.intent_status==="requires_action",[t]),c=A(async()=>{if(!s||e)return;let i=await x(t.paymentProcessorMetadata.publishable_key);if(i){r(!0);try{let{intent_client_secret:n}=t.paymentProcessorMetadata;await i.handleCardAction(n)}finally{r(!1)}}},[t,s,e]);return[s,c,e]};export{g as useCheckoutFulfillmentListener,N as useHandleNextAction};
