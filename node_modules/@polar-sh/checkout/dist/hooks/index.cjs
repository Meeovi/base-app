"use strict";"use client";var N=Object.create;var d=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var q=(e,t)=>{for(var o in t)d(e,o,{get:t[o],enumerable:!0})},P=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of U(t))!$.call(e,r)&&r!==o&&d(e,r,{get:()=>t[r],enumerable:!(s=R(t,r))||s.enumerable});return e};var D=(e,t,o)=>(o=e!=null?N(F(e)):{},P(t||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e)),z=e=>P(d({},"__esModule",{value:!0}),e);var J={};q(J,{useCheckoutFulfillmentListener:()=>w,useHandleNextAction:()=>x});module.exports=z(J);var m=require("react");var L=require("event-source-plus"),E=D(require("eventemitter3"),1),_=e=>{let t=new E.default,o=new L.EventSourcePlus(e,{credentials:"include"}),s={onMessage:async u=>{let c=JSON.parse(u.data);t.emit(c.key,c.payload)}};return[t,()=>o.listen(s)]};var w=(e,t,o=15e3)=>{let[s,r]=(0,m.useState)(null);return[(0,m.useCallback)(async()=>await new Promise((c,A)=>{let H=`${e._baseURL}v1/checkouts/client/${t.clientSecret}/stream`,[n,M]=_(H),h=M(),p=!1,f=!1,a=t.productPrice.type!=="recurring",b=!1,l=()=>{p&&f&&a&&r(`Waiting confirmation from ${t.organization.name} `),p&&f&&a&&b&&(h.abort(),c())},v=k=>{k.status==="succeeded"&&(p=!0,r("Payment successful! Processing order..."),n.off("checkout.updated",v),l())};n.on("checkout.updated",v);let C=()=>{f=!0,n.off("checkout.order_created",C),l()};n.on("checkout.order_created",C);let y=()=>{a=!0,n.off("checkout.subscription_created",y),l()};a||n.on("checkout.subscription_created",y);let S=k=>{k.status==="succeeded"&&(b=!0,n.off("checkout.webhook_event_delivered",S),l())};n.on("checkout.webhook_event_delivered",S),setTimeout(()=>{h.abort(),A()},o)}),[e,t,o]),s]};var g=require("@stripe/stripe-js"),i=require("react"),x=e=>{let[t,o]=(0,i.useState)(!1),s=(0,i.useMemo)(()=>e.paymentProcessorMetadata?.intent_status==="requires_action",[e]),r=(0,i.useCallback)(async()=>{if(!s||t)return;let u=await(0,g.loadStripe)(e.paymentProcessorMetadata.publishable_key);if(u){o(!0);try{let{intent_client_secret:c}=e.paymentProcessorMetadata;await u.handleCardAction(c)}finally{o(!1)}}},[e,s,t]);return[s,r,t]};0&&(module.exports={useCheckoutFulfillmentListener,useHandleNextAction});
